<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* ========== CSS VARIABLES ========== */
    :root {
      /* Base Colors */
      --background-color: #ffffff;
      --text-color: #333333;
      --border-color: #e5e7eb;
      --description-color: #6b7280;
      --label-color: #374151;
      --form-label-color: #374151;
      
      /* Form Elements */
      --input-background: #ffffff;
      --input-text: #333333;
      
      /* Buttons */
      --button-primary-bg: #18a0fb;
      --button-primary-text: #ffffff;
      --button-secondary-bg: #e5e7eb;
      --button-secondary-text: #374151;
      
      /* Navigation Tabs */
      --tab-active-bg: #18a0fb;
      --tab-active-text: #ffffff;
      --tab-inactive-bg: #f3f4f6;
      --tab-inactive-text: #6b7280;
      
      /* Status Messages */
      --error-color: #c62828;
      --error-bg: #ffebee;
      --warning-color: #f59e0b;
      --success-color: #10b981;
      
      /* UI Components */
      --component-bg: #f9fafb;
      --component-hover: #f3f4f6;
      --preview-bg: #f3f4f6;
      
      /* Modal and Overlay */
      --modal-bg: #ffffff;
      --modal-overlay: rgba(0, 0, 0, 0.5);
      --settings-bg: #ffffff;
      
      /* States */
      --disabled-bg: #f3f4f6;
      --disabled-text: #9ca3af;
      
      /* Tags and Labels */
      --tag-bg: #efe1e8;
      --tag-text: #792856;
      --tag-secondary-bg: #d1e0ff;
      --tag-secondary-text: #1a56db;
      
      /* Library Colors */
      --library-bg: #e6f7ff;
      --library-text: #0070e0;
      
      /* Color Samples and Shadows */
      --color-sample-border: rgba(0, 0, 0, 0.1);
      --box-shadow-light: rgba(0, 0, 0, 0.1);
      --box-shadow-medium: rgba(0, 0, 0, 0.15);
      
      /* Variable Type Backgrounds */
      --color-type-bg: rgba(198, 40, 40, 0.2);
      --number-type-bg: rgba(46, 125, 50, 0.2);
      --text-type-bg: rgba(21, 101, 192, 0.2);
      --boolean-type-bg: rgba(239, 108, 0, 0.2);
      --fill-type-bg: rgba(123, 31, 162, 0.2);
      --stroke-type-bg: rgba(57, 73, 171, 0.15);
      --effect-type-bg: rgba(0, 105, 92, 0.15);
      --text-style-type-bg: rgba(194, 24, 91, 0.15);
      --grid-type-bg: rgba(85, 139, 47, 0.15);
    }
    
    /* Dark theme - Dracula Theme */
    body.dark-theme {
      /* Base Colors */
      --background-color: #282a36; /* Dracula Background */
      --text-color: #f8f8f2; /* Dracula Foreground */
      --border-color: #44475a; /* Dracula Current Line */
      --description-color: #bd93f9; /* Dracula Purple - better contrast */
      --label-color: #f8f8f2; /* Dracula Foreground */
      --form-label-color: #f8f8f2; /* Dracula Foreground */
      
      /* Form Elements */
      --input-background: #383a59; /* Darker than Selection */
      --input-text: #f8f8f2; /* Dracula Foreground */
      
      /* Buttons */
      --button-primary-bg: #8be9fd; /* Dracula Cyan */
      --button-primary-text: #282a36; /* Dracula Background */
      --button-secondary-bg: #6272a4; /* Dracula Comment */
      --button-secondary-text: #f8f8f2; /* Dracula Foreground */
      
      /* Navigation Tabs */
      --tab-active-bg: #bd93f9; /* Dracula Purple */
      --tab-active-text: #282a36; /* Dracula Background */
      --tab-inactive-bg: #44475a; /* Dracula Current Line */
      --tab-inactive-text: #f8f8f2; /* Dracula Foreground */
      
      /* Status Messages */
      --error-color: #ff5555; /* Dracula Red */
      --error-bg: rgba(255, 85, 85, 0.15); /* Dracula Red with reduced opacity */
      --warning-color: #ffb86c; /* Dracula Orange */
      --success-color: #50fa7b; /* Dracula Green */
      
      /* UI Components */
      --component-bg: #44475a; /* Dracula Selection */
      --component-hover: #6272a4; /* Dracula Comment */
      --preview-bg: #383a59; /* Darker than Selection */
      
      /* Modal and Overlay */
      --modal-bg: #282a36; /* Dracula Background */
      --modal-overlay: rgba(0, 0, 0, 0.7);
      --settings-bg: #282a36; /* Dracula Background */
      
      /* States */
      --disabled-bg: #44475a; /* Dracula Selection */
      --disabled-text: #6272a4; /* Dracula Comment */
      
      /* Tags and Labels */
      --tag-bg: #ff79c6; /* Dracula Pink */
      --tag-text: #282a36; /* Dracula Background */
      --tag-secondary-bg: #bd93f9; /* Dracula Purple */
      --tag-secondary-text: #282a36; /* Dracula Background */
      
      /* Library Colors */
      --library-bg: #6272a4; /* Dracula Comment */
      --library-text: #f8f8f2; /* Dracula Foreground */
      
      /* Color Samples and Shadows */
      --color-sample-border: rgba(255, 255, 255, 0.2);
      --box-shadow-light: rgba(0, 0, 0, 0.3);
      --box-shadow-medium: rgba(0, 0, 0, 0.4);
      
      /* Variable Type Backgrounds */
      --color-type-bg: rgba(255, 85, 85, 0.2);
      --number-type-bg: rgba(80, 250, 123, 0.2);
      --text-type-bg: rgba(189, 147, 249, 0.2);
      --boolean-type-bg: rgba(255, 184, 108, 0.2);
      --fill-type-bg: rgba(189, 147, 249, 0.2);
      --stroke-type-bg: rgba(139, 233, 253, 0.15);
      --effect-type-bg: rgba(80, 250, 123, 0.15);
      --text-style-type-bg: rgba(255, 121, 198, 0.15);
      --grid-type-bg: rgba(80, 250, 123, 0.15);
      
      /* Radio Buttons */
      --radio-border: #6272a4; /* Dracula Comment */
      --radio-checked: #bd93f9; /* Dracula Purple */
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      color: var(--text-color);
      background-color: var(--background-color);
    }
    
    .container {
      padding: 16px;
      margin-bottom: 48px;
    }
    
    h2 {
      font-size: 16px;
      margin-bottom: 12px;
    }
    
    .component-item {
      padding: 12px;
      border-radius: 6px;
      background-color: var(--component-bg);
      margin-bottom: 8px;
    }
    
    .library-label {
      display: inline-block;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 3px;
      margin-right: 6px;
      margin-bottom: 0.25rem;
      background-color: var(--tag-bg);
      color: var(--tag-text);
    }
    
    .component-name {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .component-id {
      font-size: 12px;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 4px;
    }
    
    .library-name {
      font-size: 12px;
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      background-color: var(--library-bg);
      color: var(--library-text);
      margin-top: 4px;
    }
    
    .no-components {
      color: var(--description-color);
      font-style: italic;
    }
    
    .error-message {
      background-color: var(--error-bg);
      color: var(--error-color);
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
      border-left: 4px solid var(--error-color);
    }
    
    /* Ajustes específicos para o tema claro */
    body:not(.dark-theme) .error-message {
      background-color: var(--error-bg);
      color: var(--error-color);
    }
    
    .info-message {
      background-color: var(--error-bg);
      color: var(--tag-secondary-bg);
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
      border-left: 4px solid var(--tag-secondary-bg);
    }
    
    /* Ajustes específicos para o tema claro - info message */
    body:not(.dark-theme) .info-message {
      background-color: var(--library-bg);
      color: var(--library-text);
      border-left: 4px solid var(--library-text);
    }
    
    .action-button {
      background-color: var(--button-primary-bg);
      color: var(--button-primary-text);
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      margin-top: 16px;
      display: block;
      width: 100%;
    }
    
    .action-button:hover {
      background-color: var(--button-primary-bg);
      filter: brightness(90%);
    }

    .library-select {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 12px;
      background-color: var(--input-background);
      color: var(--text-color);
    }

    .collections-container {
      margin-top: 16px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 12px;
      max-height: 200px;
      overflow-y: auto;
    }

    .collection-item {
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 6px;
      background-color: var(--component-bg);
    }

    .collection-name {
      font-weight: 500;
      font-size: 13px;
    }

    .collection-type {
      font-size: 11px;
      color: var(--text-color);
      opacity: 0.7;
      margin-top: 2px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 16px 0 8px;
      padding-bottom: 4px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-color);
    }

    .loading {
      display: none;
      margin: 16px 0;
      color: var(--text-color);
      opacity: 0.8;
      font-style: italic;
    }

    .hidden {
      display: none;
    }
    
    /* Estilos para as abas */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      background-color: var(--background-color);
      z-index: 100;
      padding: 16px 16px 0 16px;
    }
    
    .tab {
      padding: 4px 8px;
      margin-right: 0.5em;
      border: none;
      background: none;
      color: var(--text-color);
      opacity: 0.7;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      margin-bottom: -1px;
    }
    
    .tab.active {
      color: var(--button-primary-bg);
      border-bottom: 2px solid var(--button-primary-bg);
      opacity: 1;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }

    .tab-content > h2 {
      font-size: 0.8rem;
      text-transform: uppercase;
    }

    /* Estilos para a aba Update Collections */
    .variable-form {
      margin-top: 16px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--label-color);
    }
    
    .form-input, .form-select {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      font-size: 14px;
      margin-bottom: 8px;
      background-color: var(--input-background);
      color: var(--input-text);
    }
    
    .form-select {
      background-color: var(--input-background);
      color: var(--input-text);
    }
    
    .form-help {
      font-size: 11px;
      color: var(--description-color);
      margin-top: 4px;
    }
    
    .variable-preview {
      background-color: var(--preview-bg);
      border-radius: 6px;
      padding: 12px;
      margin-top: 16px;
    }
    
    .preview-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-color);
    }
    
    .preview-content {
      font-size: 12px;
      color: var(--text-color);
      opacity: 0.9;
      font-family: 'Roboto Mono', monospace;
    }
    
    /* Estilos para radio buttons */
    .radio-group {
      margin-bottom: 12px;
      font-size: 12px;
      color: var(--text-color);
    }
    
    .radio-label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      cursor: pointer;
      color: var(--text-color);
    }
    
    .radio-label input {
      margin-right: 8px;
    }

    .secondary-button {
      background-color: var(--button-secondary-bg);
      color: var(--button-secondary-text);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      margin-top: 8px;
      display: block;
      width: 100%;
    }
    
    .secondary-button:hover {
      background-color: var(--component-hover);
    }

    .secondary-button:disabled {
      background-color: var(--disabled-bg);
      color: var(--disabled-text);
      cursor: not-allowed;
    }
    
    /* Estilos específicos para botões desabilitados no modo claro */
    body:not(.dark-theme) .secondary-button:disabled {
      background-color: var(--disabled-bg-light);
      color: var(--disabled-text-light);
    }

    .action-button:disabled {
      background-color: var(--disabled-bg);
      color: var(--disabled-text);
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    /* Estilos específicos para botões de ação desabilitados no modo claro */
    body:not(.dark-theme) .action-button:disabled {
      background-color: var(--disabled-text);
      color: var(--button-primary-text);
      opacity: 0.7;
    }

    .preview-section {
      margin-bottom: 16px;
    }

    .preview-subtitle {
      font-size: 12px;
      font-weight: 600;
      color: var(--label-color);
      margin-bottom: 8px;
    }

    .preview-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .preview-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 8px;
      border-radius: 4px;
      background-color: var(--input-background);
      margin-bottom: 4px;
      font-size: 12px;
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }

    .preview-item:hover {
      background-color: var(--component-hover);
    }
    
    /* Estilos específicos para o modo escuro */
    body.dark-theme .preview-item {
      background-color: var(--component-bg);
      border-color: var(--border-color);
    }
    
    body.dark-theme .preview-item:hover {
      background-color: var(--component-hover);
    }

    .variable-name {
      color: var(--text-color);
      font-family: 'Roboto Mono', monospace;
    }

    .variable-collection {
      color: var(--text-color);
      opacity: 0.8;
      font-size: 11px;
      padding: 2px 6px;
      background-color: var(--component-bg);
      border-radius: 3px;
    }

    .preview-more {
      font-size: 11px;
      color: var(--text-color);
      opacity: 0.7;
      padding: 4px 8px;
      font-style: italic;
    }

    /* Grupos de variáveis/estilos - Layout mais compacto */
    .variable-group {
      margin-bottom: 12px;
      overflow: hidden; /* Para conter qualquer elemento que possa transbordar */
    }

    .variable-group h3 {
      font-size: 11px;
      font-weight: 500;
      margin: 4px 0;
      color: var(--text-color);
      opacity: 0.8;
    }

    .variable-group ul {
      list-style: none;
      padding: 0;
      margin: 0;
      max-width: 100%;
    }

    .variable-group li {
      display: flex;
      align-items: center;
      padding: 3px 6px;
      margin: 1px 0;
      border-radius: 3px;
      background: var(--component-bg);
      font-size: 11px;
      max-width: 100%;
      box-sizing: border-box;
      color: var(--text-color);
    }

    .var-name {
      flex: 1;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px;
      min-width: 0; /* Permite que o flex shrink funcione corretamente */
    }

    .var-type {
      padding: 1px 4px;
      margin: 0 4px;
      border-radius: 3px;
      font-size: 10px;
      white-space: nowrap;
    }

    .var-collection {
      font-size: 10px;
      color: var(--description-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 80px;
      min-width: 0; /* Permite que o flex shrink funcione corretamente */
    }

    .more-items {
      color: var(--description-color);
      font-style: italic;
      text-align: center;
      padding: 2px 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .load-more-button {
      background-color: transparent;
      color: var(--button-primary-bg);
      border: 1px solid var(--button-primary-bg);
      border-radius: 3px;
      padding: 2px 8px;
      font-size: 10px;
      cursor: pointer;
      margin: 4px auto;
      display: block;
      width: auto;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .load-more-button:hover {
      background-color: var(--component-hover);
    }

    /* Seções - Layout mais compacto */
    .section-title {
      font-size: 12px;
      font-weight: 600;
      margin: 12px 0 6px;
      padding-bottom: 3px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-color);
    }

    /* Tipos específicos de variáveis */
    .var-type.color {
      background: var(--color-type-bg);
      color: var(--error-color);
    }

    .var-type.number {
      background: var(--number-type-bg);
      color: var(--success-color);
    }

    .var-type.text {
      background: var(--text-type-bg);
      color: var(--tag-secondary-text);
    }

    .var-type.boolean {
      background: var(--boolean-type-bg);
      color: var(--warning-color);
    }

    /* Tipos específicos de estilos */
    .var-type.fill {
      background: var(--fill-type-bg);
      color: var(--tag-secondary-bg);
    }

    .var-type.stroke {
      background: var(--stroke-type-bg);
      color: var(--tag-secondary-text);
    }

    .var-type.effect {
      background: var(--effect-type-bg);
      color: var(--success-color);
    }

    .var-type.text-style {
      background: var(--text-style-type-bg);
      color: var(--tag-text);
    }

    .var-type.grid {
      background: var(--grid-type-bg);
      color: var(--success-color);
    }

    /* Mensagens */
    .message {
      padding: 8px 12px;
      margin: 8px 0;
      border-radius: 4px;
      font-size: 12px;
    }

    .error {
      background: var(--error-bg);
      color: var(--error-color);
    }

    .info {
      background: var(--library-bg);
      color: var(--library-text);
    }

    /* Estilo para a lista de correspondências */
    .variables-list {
      margin-top: 10px;
    }
    
    .match-item {
      padding: 15px;
      margin-bottom: 0;
      border-bottom: 1px solid var(--border-color);
      background-color: var(--component-bg);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text-color);
    }
    
    .match-local {
      margin-bottom: 4px;
    }
    
    .match-library {
      color: var(--text-color);
      opacity: 0.7;
      font-size: 11px;
    }
    
    .warning {
      color: var(--warning-color);
      font-style: italic;
    }

    /* Adicionando estilos para a visualização de correspondências */
    .matches-pagination {
      margin-top: 10px;
      display: flex;
      gap: 8px;
    }
    
    .pagination-button {
      background-color: var(--button-secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      color: var(--button-secondary-text);
    }
    
    .pagination-button:hover {
      background-color: var(--component-hover);
    }
    
    .matches-container {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      margin-top: 8px;
      background-color: var(--component-bg);
    }
    
    .match-local {
      font-size: 13px;
      margin-bottom: 4px;
    }
    
    .match-library {
      font-size: 12px;
      color: var(--description-color);
    }
    
    .matches-filter {
      margin-bottom: 10px;
    }
    
    .matches-filter input {
      width: 100%;
      padding: 6px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 12px;
    }

    /* Estilos para os modos e valores das variáveis */
    .modes-container {
      margin-top: 10px;
      background-color: var(--background-color);
      border-radius: 6px;
      padding: 10px;
    }

    .modes-title {
      font-weight: 600;
      font-size: 12px;
      margin-bottom: 5px;
      color: var(--text-color);
    }

    .modes-list {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .mode-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 10px;
      background-color: var(--component-bg);
      border-radius: 4px;
    }

    .mode-name {
      font-weight: 500;
      font-size: 12px;
      padding: 3px 10px;
      background-color: var(--button-secondary-bg);
      color: var(--button-secondary-text);
      border-radius: 3px;
    }

    .mode-value {
      font-family: 'Roboto Mono', monospace;
      font-size: 12px;
      padding: 3px 10px;
    }

    .match-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .preview-header {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .matches-count {
      font-size: 14px;
      margin-bottom: 16px;
    }

    .matches-container {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .variavel {
      font-size: 10px;
      font-weight: 500;
      margin-bottom: 12px;;
    }

    .modes-container {
      background-color: var(--input-background);
      border-radius: 6px;
      padding: 12px;
      margin-top: 8px;
      border: 1px solid var(--border-color);
    }

    .modes-title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 8px;
      color: var(--text-color);
    }

    .modes-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .mode-row {
      display: flex;
      align-items: center;
      background-color: var(--component-bg);
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .mode-name {
      background-color: var(--button-secondary-bg);
      color: var(--button-secondary-text);
      padding: 4px 8px;
      font-size: 12px;
      font-weight: 500;
      min-width: 80px;
    }
    
    /* Estilos específicos para o modo escuro */
    body.dark-theme .mode-name {
      background-color: var(--button-secondary-bg); /* Dracula Comment */
      color: var(--text-color); /* Dracula Foreground */
    }

    .mode-value {
      padding: 4px 8px;
      font-size: 12px;
      font-family: monospace;
      color: var(--text-color);
      flex-grow: 1;
    }

    .matches-pagination {
      margin-top: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }



    .pagination-button:hover {
      background-color: var(--component-hover);
    }

    /* Estilos para exibição de amostras de cores */
    .color-preview {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      margin-right: 6px;
      border: 1px solid var(--color-sample-border);
      display: inline-block;
      vertical-align: middle;
    }

    /* Garantindo que as cores sejam exibidas corretamente */
    .var-type.color {
      background: var(--color-type-bg);
      color: var(--error-color);
      display: flex;
      align-items: center;
    }

    /* Estilos para o modal de confirmação */
    /* Footer styles */
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40px;
      background-color: var(--component-bg);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 16px;
      font-size: 11px;
      color: var(--text-color);
      z-index: 1001;
      box-sizing: border-box;
    }

    .footer-version {
      font-weight: 500;
      opacity: 0.8;
    }

    .footer-settings {
      display: flex;
      align-items: center;
    }

    .settings-button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 11px;
      padding: 4px 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      gap: 4px;
      color: var(--text-color);
    }
    
    .settings-button span.material-icons {
      font-size: 14px;
    }

    .settings-button:hover {
      background-color: var(--component-hover);
    }

    /* Settings overlay styles */
    .settings-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--modal-overlay);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      visibility: hidden;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .settings-overlay.active {
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
    }

    .settings-container {
      background-color: var(--settings-bg);
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
      max-height: 80%;
      overflow-y: auto;
      box-shadow: 0 4px 6px var(--box-shadow-light);
      border: 1px solid var(--border-color);
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: .5rem 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .settings-title {
      margin: 0;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-color);
    }

    .settings-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--text-color);
    }

    .settings-content {
      padding: 16px;
    }

    .settings-section {
      margin-bottom: 16px;
    }

    .settings-section label {
      display: block;
      margin-bottom: 8px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-color);
    }

    .settings-select {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--input-background);
      color: var(--text-color);
      font-size: 12px;
      margin-bottom: 16px;
    }
    

    
    .settings-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 16px;
      gap: 12px;
    }
    
    /* Common button styles */
    .settings-button-secondary,
    .settings-button-primary {
      flex: 1;
      min-width: 120px;
      max-width: 180px;
      height: 32px;
      padding: 0 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    /* Secondary button (Cancel) */
    .settings-button-secondary {
      background-color: var(--button-secondary-bg);
      color: var(--button-secondary-text);
      border: 1px solid var(--border-color);
    }
    
    .settings-button-secondary:hover {
      background-color: var(--component-hover);
    }
    
    /* Primary button (Update) */
    .settings-button-primary {
      background-color: var(--button-primary-bg);
      color: var(--button-primary-text);
      border: none;
    }
    
    .settings-button-primary:hover {
      background-color: var(--button-primary-bg);
      filter: brightness(90%);
    }
    
    /* Active state for both buttons */
    .settings-button-secondary:active,
    .settings-button-primary:active {
      transform: scale(0.98);
    }

    /* Loading overlay styles */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--modal-overlay);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
      pointer-events: none;
    }
    
    .loading-overlay.active {
      opacity: 1;
      visibility: visible;
      pointer-events: all;
      backdrop-filter: blur(2px);
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--component-bg);
      border-top: 4px solid var(--button-primary-bg);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }
    
    .loading-text {
      font-size: 14px;
      color: var(--text-color);
      font-weight: 500;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Modal overlay styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--modal-overlay);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-container {
      background: var(--modal-bg);
      border-radius: 8px;
      padding: 24px;
      width: 80%;
      max-width: 500px;
      max-height: 80vh;
      box-shadow: 0 4px 12px var(--box-shadow-medium);
      display: flex;
      flex-direction: column;
      font-size: 12px;
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }
    
    .modal-header {
      margin-bottom: 16px;
    }
    
    .modal-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--text-color);
      margin: 0;
    }
    
    .modal-content {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 16px;
    }
    .modal-group-header {
      font-size: 0.75em;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--text-color);
      padding: 0.5em;
    }
    
    .modal-group-header:not(:first-child) {
      margin-top: 1em;
    }
    .modal-variables-list {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 8px;
    }
    
    .var-item {
      padding: 6px 8px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
    }
    
    .var-item:last-child {
      border-bottom: none;
    }
    
    .modal-item-match {
      color: var(--background-color);
      margin-left: 4px;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      background-color: var(--success-color);
    }
    
    .modal-item-no-match {
      color: var(--background-color);
      margin-left: 4px;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      background-color: var(--error-color);
    }
    
    .modal-item-native {
      color: var(--background-color);
      margin-left: 4px;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      background-color: var(--tag-bg);
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
    }
    
    .modal-button {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      margin-left: 8px;
    }
    
    .modal-button-cancel {
      background-color: var(--button-secondary-bg);
      color: var(--button-secondary-text);
    }
    
    .modal-button-confirm {
      background-color: var(--button-primary-bg);
      color: var(--button-primary-text);
    }
    
    .modal-button-confirm:hover {
      background-color: var(--button-primary-bg);
      opacity: 0.9;
    }
    
    .modal-button-cancel:hover {
      background-color: var(--button-secondary-bg);
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="main-content" style="padding-top: 0;">
  <!-- Abas de navegação -->
  <div class="tabs">
    <div class="tab active" data-tab="update-collections">Update Collections</div>
    <div class="tab" data-tab="update-variables">Update Variables</div>
    <div class="tab" data-tab="list-libs">List Libraries</div>
  </div>
  
  <!-- Conteúdo da Aba Update Collections -->
  <div id="update-collections" class="tab-content active container">
    <h2 id="update-collections-heading">Atualizar Collections</h2>
    <div id="error-container-update" style="display: none;" class="error-message"></div>
    <div id="info-container-update" style="display: none;" class="info-message"></div>
    
    <div class="variable-form">
      <div class="form-group">
        <label class="form-label">Biblioteca de referência:</label>
        <select id="library-select-update" class="form-select">
          <option value="" data-i18n="loading_libraries">Carregando bibliotecas...</option>
        </select>
        <p class="form-help" data-i18n="select_external_library_help">Selecione a biblioteca externa com as variáveis que deseja usar como referência</p>
      </div>
      
      <div class="form-group">
        <label class="form-label">Coleção local:</label>
        <select id="local-collection-select" class="form-select">
          <option value="" id="loading-collections-option" data-i18n="loading_local_collections">Carregando coleções locais...</option>
        </select>
        <p class="form-help" data-i18n="select_local_collection_help">Selecione a coleção local que deseja atualizar</p>
      </div>
      
      <div class="variable-preview">
        <div class="preview-title">Pré-visualização:</div>
        <div id="preview-content" class="preview-content">
          Ainda não há nada para pré-visualizar.
          Selecione uma biblioteca externa e uma coleção local para ver as correspondências.
        </div>
      </div>
      
      <button id="update-button" class="action-button" disabled>Atualizar Collections</button>
    </div>
  </div>
  
  <!-- Conteúdo da Aba Update Variables -->
  <div id="update-variables" class="tab-content container">
    <h2>Substituir Variáveis por Nó</h2>
    <div id="error-container-var" style="display: none;" class="error-message"></div>
    <div id="info-container-var" style="display: none;" class="info-message"></div>
    
    <div class="variable-form">
      <div class="form-group">
        <label class="form-label">Biblioteca de referência:</label>
        <select id="library-select-var" class="form-select">
          <option value="">${getTranslation(currentLanguage, 'loading_libraries')}</option>
        </select>
        <p class="form-help">${getTranslation(currentLanguage, 'select_external_library_help')}</p>
      </div>
      
      <div class="form-group">
        <label class="form-label">Coleção de referência:</label>
        <select id="collection-select-var" class="form-select">
          <option value="" data-i18n="select_library_first">Selecione uma biblioteca primeiro</option>
        </select>
        <p class="form-help" id="collection-help-text" data-i18n="reference_collection_help">Selecione a coleção de variáveis que deseja utilizar como referência</p>
      </div>
      
      <div class="form-group">
        <label class="form-label">Escopo de substituição</label>
        <div class="radio-group">
          <input type="radio" id="selection" name="scope" value="selection" checked>
          <label for="selection">Seleção atual</label>
        </div>
        <div class="radio-group">
          <input type="radio" id="page" name="scope" value="page">
          <label for="page">Página atual</label>
        </div>
        <!-- Search button removed as functionality moved to update button -->
      </div>
      
      <div id="variable-preview" class="variable-preview hidden" style="display: none;">
        <div class="preview-title" id="variables-found-title" data-i18n="variables_found_title">Variáveis encontradas:</div>
        <div id="preview-content-var" class="preview-content">
          <!-- Lista de variáveis será inserida aqui -->
        </div>
      </div>
      
      <div id="loading-preview-var" class="loading" style="display: none;">Procurando variáveis com os mesmos nomes...</div>
      <button id="update-button-var" class="action-button" disabled>Substituir Variáveis</button>
      <!-- <button id="teste-float-btn" class="secondary-button" style="margin-top: 10px;">Testar Float</button> -->
    </div>
  </div>
  
  <!-- Conteúdo da Aba List Libs (funcionalidade original) -->
  <div id="list-libs" class="tab-content container">
    <h2 data-i18n="list_libraries_title">Lista de Bibliotecas</h2>
    <div id="error-container" style="display: none;" class="error-message"></div>
    <div id="info-container" style="display: none;" class="info-message"></div>

    <!-- Container original para exibir todas as bibliotecas -->
    <div class="section-title">Todas as bibliotecas:</div>
    <div id="components-container">
      <p class="no-components">Procurando bibliotecas...</p>
    </div>
    
    <!-- Botão temporariamente desabilitado - será implementado no futuro -->
    <button id="refresh-button" class="action-button" style="display: none;"  disabled title="Funcionalidade temporariamente desabilitada">Recarregar</button>
  </div>

  <!-- Modal de confirmação para substituição de variáveis -->
  <div id="confirm-modal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">Confirmar Substituição de Variáveis</h3>
      </div>
      <div class="modal-content">
        <p>Você está prestes a substituir as seguintes variáveis e estilos:</p>
        <div id="modal-variables-list" class="modal-variables-list">
          <!-- Lista de variáveis a serem substituídas -->
        </div>
        <p><strong>Nota:</strong> A substituição será aplicada apenas ao escopo selecionado.</p>
      </div>
      <div class="modal-footer">
        <button id="modal-cancel" class="modal-button modal-button-cancel">Cancelar</button>
        <button id="modal-confirm" class="modal-button modal-button-confirm">Confirmar Substituição</button>
      </div>
    </div>
  </div>

  <script>
    // Localization system
    let currentLanguage = 'pt-br'; // Default language
    
    // Function to get translation
    function t(key, params = {}) {
      // Access translations directly from the global object
      if (!window.translations || !window.translations[currentLanguage] || !window.translations[currentLanguage][key]) {
        console.warn(`Translation not found for key: ${key} in language: ${currentLanguage}`);
        return key; // Return the key itself if translation not found
      }
      
      let text = window.translations[currentLanguage][key];
      
      // Replace any parameters in the text
      Object.keys(params).forEach(param => {
        text = text.replace(`{${param}}`, params[param]);
      });
      
      return text;
    }
    
    // Alias for t() function to maintain compatibility with existing code
    function getTranslation(language, key, params = {}) {
      return t(key, params);
    }
    
    // Function to process all elements with data-i18n attributes
    function processI18nElements() {
      try {
        console.log('Processing i18n elements for language:', currentLanguage);
        
        // Find all elements with data-i18n attribute
        const i18nElements = document.querySelectorAll('[data-i18n]');
        
        i18nElements.forEach(element => {
          const key = element.getAttribute('data-i18n');
          if (key && window.translations && window.translations[currentLanguage] && window.translations[currentLanguage][key]) {
            element.textContent = window.translations[currentLanguage][key];
          } else {
            console.warn(`Translation not found for key: ${key} in language: ${currentLanguage}`);
          }
        });
        
        console.log(`Processed ${i18nElements.length} i18n elements`);
      } catch (error) {
        console.error('Error processing i18n elements:', error);
      }
    }
    
    // Function to update all UI text based on selected language
    function updateUILanguage() {
      try {
        console.log('Updating UI language to:', currentLanguage);
        
        // Process all data-i18n elements
        processI18nElements();
        
        // Direct text replacements for all UI elements
        const textReplacements = [
          // Tabs
          { selector: '[data-tab="update-collections"]', key: 'update_collections' },
          { selector: '[data-tab="update-variables"]', key: 'update_variables' },
          { selector: '[data-tab="list-libs"]', key: 'list_libraries' },
          
          // Update Collections tab
          { selector: '#update-collections h2', key: 'update_collections_title' },
          { selector: '#update-collections .form-label:nth-of-type(1)', key: 'reference_library' },
          { selector: '#update-collections .form-label:nth-of-type(2)', key: 'local_collection' },
          { selector: '#update-button', key: 'update_button' },
          { selector: '.preview-title', key: 'preview_title' },
          
          // Update Variables tab
          { selector: '#update-variables h2', key: 'update_variables_title' },
          { selector: '#update-variables .form-label:nth-of-type(1)', key: 'reference_library_var' },
          { selector: '#update-variables .form-label:nth-of-type(2)', key: 'reference_collection' },
          { selector: '.scope-label', key: 'scope_selection' },
          { selector: 'label[for="scope-selection"]', key: 'current_selection' },
          { selector: 'label[for="scope-page"]', key: 'current_page' },
          { selector: '#search-button', key: 'search_variables' },
          { selector: '#replace-button', key: 'replace_variables' },
          
          // List Libraries tab
          { selector: '#list-libs h2', key: 'list_libraries_title' },
          { selector: '#list-libs .section-title', key: 'all_libraries' },
          { selector: '#components-container .no-components', key: 'searching_libraries' },
          { selector: '#refresh-button', key: 'reload' },
          
          // Settings
          { selector: '#settings-button span:last-child', key: 'settings' },
          { selector: '.settings-title', key: 'settings_title' },
          { selector: 'label[for="language-select"]', key: 'language' },
          { selector: '#settings-cancel', key: 'cancel' },
          { selector: '#settings-update', key: 'save' },
          
          // Loading text
          { selector: '#loading-text', key: 'processing' }
        ];
        
        // Apply all text replacements
        textReplacements.forEach(item => {
          const element = document.querySelector(item.selector);
          if (element) {
            element.textContent = t(item.key);
          }
        });
        
        // Update help texts
        const helpTexts = document.querySelectorAll('#update-collections .form-help');
        if (helpTexts.length >= 2) {
          helpTexts[0].textContent = t('select_external_library_help');
          helpTexts[1].textContent = t('select_local_collection_help');
        }
        
        // Update select options
        const librarySelectUpdate = document.querySelector('#library-select-update');
        if (librarySelectUpdate && librarySelectUpdate.options.length > 0) {
          if (librarySelectUpdate.options[0].text.includes('Carregando') || 
              librarySelectUpdate.options[0].text.includes('Loading')) {
            librarySelectUpdate.options[0].text = t('loading_libraries');
          }
        }
        
        const localCollectionSelect = document.querySelector('#local-collection-select');
        if (localCollectionSelect && localCollectionSelect.options.length > 0) {
          if (localCollectionSelect.options[0].text.includes('Carregando') || 
              localCollectionSelect.options[0].text.includes('Loading')) {
            localCollectionSelect.options[0].text = t('loading_local_collections');
          } else if (localCollectionSelect.options[0].text.includes('Nenhuma') || 
                     localCollectionSelect.options[0].text.includes('No')) {
            localCollectionSelect.options[0].text = t('no_collections');
          }
        }
        
        // Update preview content
        const previewContent = document.querySelector('#preview-content');
        if (previewContent) {
          const contentText = previewContent.textContent.trim();
          if (contentText.includes('Ainda não há nada') || contentText.includes('Nothing to preview')) {
            previewContent.textContent = t('no_preview_yet');
          }
        }
        
        // Update error messages
        const errorContainerUpdate = document.querySelector('#error-container-update');
        if (errorContainerUpdate && errorContainerUpdate.style.display !== 'none') {
          const errorText = errorContainerUpdate.textContent.trim();
          if (errorText.includes('Nenhuma coleção local encontrada') || 
              errorText.includes('No local collection found')) {
            errorContainerUpdate.textContent = t('no_local_collections');
          }
        }
        
        // Update error messages in variables tab
        const errorContainerVar = document.querySelector('#error-container-var');
        if (errorContainerVar && errorContainerVar.style.display !== 'none') {
          const errorText = errorContainerVar.textContent.trim();
          if (errorText.includes('Nenhuma variável ou estilo encontrado') || 
              errorText.includes('No variables or styles found')) {
            errorContainerVar.textContent = t('no_variables_found_selection');
          }
        }
        
        // Update confirmation modal if it exists
        const confirmTitle = document.querySelector('.modal-title');
        if (confirmTitle) {
          confirmTitle.textContent = t('confirm_replacement');
        }
        
        const variablesToReplaceTitle = document.querySelector('.variables-to-replace-title');
        if (variablesToReplaceTitle) {
          const count = variablesToReplaceTitle.textContent.match(/\d+/);
          if (count) {
            variablesToReplaceTitle.textContent = t('variables_to_be_replaced', { count: count[0] });
          }
        }
        
        const variablesNoMatchTitle = document.querySelector('.variables-no-match-title');
        if (variablesNoMatchTitle) {
          const count = variablesNoMatchTitle.textContent.match(/\d+/);
          if (count) {
            variablesNoMatchTitle.textContent = t('variables_without_matches', { count: count[0] });
          }
        }
        
        // Update match/no match indicators
        const willBeReplacedElements = document.querySelectorAll('.will-be-replaced');
        willBeReplacedElements.forEach(el => {
          el.textContent = t('will_be_replaced');
        });
        
        const noMatchElements = document.querySelectorAll('.no-match');
        noMatchElements.forEach(el => {
          el.textContent = t('no_match_found');
        });
        
        // Update note text
        const noteElement = document.querySelector('.modal-note');
        if (noteElement) {
          noteElement.textContent = t('replacement_note');
        }
        
        // Update modal buttons
        const cancelButton = document.querySelector('.modal-button-cancel');
        if (cancelButton) {
          cancelButton.textContent = t('cancel');
        }
        
        const confirmButton = document.querySelector('.modal-button-confirm');
        if (confirmButton) {
          confirmButton.textContent = t('confirm_button');
        }
        
        // Update footer with language indicator
        const footerVersion = document.querySelector('.footer-version');
        if (footerVersion) {
          const version = '0.6.0-beta';
          const langCode = t('language_code');
          footerVersion.textContent = t('version_with_lang', { version: version, lang: langCode });
        }
        
        console.log('UI language updated successfully');
      } catch (error) {
        console.error('Error updating UI language:', error);
      }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
    // Elementos do DOM para ambas as abas
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

      // Elementos da interface
    const componentsContainer = document.getElementById('components-container');
    const errorContainer = document.getElementById('error-container');
    const infoContainer = document.getElementById('info-container');
    const refreshButton = document.getElementById('refresh-button');
    const librarySelect = null; // Removido da interface
    const collectionsContainer = null; // Removido da interface
    const collectionsLoading = null; // Removido da interface
    const collectionsList = null; // Removido da interface
    const collectionsEmpty = null; // Removido da interface
    const librarySelectUpdate = document.getElementById('library-select-update');
    const localCollectionSelect = document.getElementById('local-collection-select');
    const previewContent = document.getElementById('preview-content');
    const updateButton = document.getElementById('update-button');
    const errorContainerUpdate = document.getElementById('error-container-update');
    const infoContainerUpdate = document.getElementById('info-container-update');
      const librarySelectVar = document.getElementById('library-select-var');
    const collectionSelectVar = document.getElementById('collection-select-var');
      const previewContentVar = document.getElementById('preview-content-var');
      const updateButtonVar = document.getElementById('update-button-var');
      const errorContainerVar = document.getElementById('error-container-var');
      const infoContainerVar = document.getElementById('info-container-var');
      const loadingPreviewVar = document.getElementById('loading-preview-var');
      // Button removed - const searchVariablesBtn = document.getElementById('searchVariablesBtn');
      const variablePreview = document.getElementById('variable-preview');
      
      // Variável para armazenar as variáveis encontradas
      let foundVariables = [];
    
    // Função para alternar entre abas
    function switchTab(tabId) {
        // Ocultar todos os conteúdos de abas
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.display = 'none';
        });
        
        // Desmarcar todas as abas
        document.querySelectorAll('.tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // Exibir o conteúdo da aba selecionada
        document.getElementById(tabId).style.display = 'block';
        
        // Marcar a aba selecionada
      document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
        
        // Notificar o plugin sobre a mudança de aba
        parent.postMessage({
          pluginMessage: { 
            type: 'activeTabChanged', 
            tabId: tabId 
          }
        }, '*');
      }
      
      // Adicionar listeners para as abas
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
        const tabId = tab.getAttribute('data-tab');
        switchTab(tabId);
      });
    });
    
    // Função para mostrar erro na aba List Libs
    function showError(message) {
      errorContainer.textContent = message || "Ocorreu um erro desconhecido";
      errorContainer.style.display = "block";
    }
    
    // Função para esconder erro na aba List Libs
    function hideError() {
      errorContainer.style.display = "none";
    }
    
    // Função para mostrar informação na aba List Libs
    function showInfo(message) {
      infoContainer.textContent = message || "";
      infoContainer.style.display = message ? "block" : "none";
    }
    
      // Função para mostrar erro na aba Update Collections
    function showErrorUpdate(message) {
      errorContainerUpdate.textContent = message || "Ocorreu um erro desconhecido";
      errorContainerUpdate.style.display = "block";
    }
    
      // Função para esconder erro na aba Update Collections
    function hideErrorUpdate() {
      errorContainerUpdate.style.display = "none";
    }
    
      // Função para mostrar informação na aba Update Collections
    function showInfoUpdate(message) {
      infoContainerUpdate.textContent = message || "";
      infoContainerUpdate.style.display = message ? "block" : "none";
    }

    // Função para mostrar o loading das coleções
    function showCollectionsLoading() {
      if (!collectionsLoading) return;
      collectionsLoading.classList.remove('hidden');
      if (collectionsList) collectionsList.classList.add('hidden');
      if (collectionsEmpty) collectionsEmpty.classList.add('hidden');
    }

    // Função para mostrar a lista vazia
    function showCollectionsEmpty() {
      if (!collectionsEmpty) return;
      if (collectionsLoading) collectionsLoading.classList.add('hidden');
      if (collectionsList) collectionsList.classList.add('hidden');
      collectionsEmpty.classList.remove('hidden');
    }

    // Função para mostrar a lista de coleções
    function showCollectionsList() {
      if (!collectionsList) return;
      if (collectionsLoading) collectionsLoading.classList.add('hidden');
      collectionsList.classList.remove('hidden');
      if (collectionsEmpty) collectionsEmpty.classList.add('hidden');
    }

    // Função para limpar a lista de coleções
    function clearCollectionsList() {
      if (!collectionsList) return;
      while (collectionsList.firstChild) {
        collectionsList.removeChild(collectionsList.firstChild);
      }
    }
    
    // Função para atualizar a prévia de substituição de variáveis
    function updatePreview() {
      const libraryId = librarySelectUpdate.value;
      const localCollectionId = localCollectionSelect.value;
      
      if (!libraryId || !localCollectionId) {
        previewContent.textContent = "Ainda não há nada para pré-visualizar.\nSelecione uma biblioteca externa e uma coleção local.";
        updateButton.disabled = true;
        return;
      }
      
      // Solicitar uma prévia das substituições
      previewContent.textContent = getTranslation(currentLanguage, 'loading_preview');
      
      parent.postMessage({ 
        pluginMessage: { 
          type: 'preVisualizarSubstituicao', 
          libraryId: libraryId,
          localCollectionId: localCollectionId
        } 
      }, '*');
    }
    
    // Variável para armazenar o ID do timeout
    let libraryLoadingTimeout;
    
    // Função para lidar com timeout de carregamento de bibliotecas
    function handleLibraryLoadingTimeout() {
      console.error('[UI] Timeout: Carregamento de bibliotecas excedeu o tempo limite');
      if (componentsContainer) {
        componentsContainer.innerHTML = '<p class="error-message">Falha ao carregar bibliotecas. O tempo limite foi excedido.</p>';
      }
      showError("Falha ao carregar bibliotecas. Tente novamente ou reinicie o plugin.");
      hideLoadingOverlay();
      
      // Notificar o plugin sobre o timeout
      parent.postMessage({ 
        pluginMessage: { 
          type: 'loading-timeout',
          message: 'O carregamento de bibliotecas excedeu o tempo limite'
        } 
      }, '*');
    }
    
    // Variável para armazenar o ID do timeout de forçar exibição
    let forceDisplayTimeout;
    
    // Função para forçar a exibição das bibliotecas mesmo sem resposta
    function forceDisplayLibraries() {
      console.warn('[UI] Forçando exibição das bibliotecas após timeout');
      
      // Esconder o loading overlay
      hideLoadingOverlay();
      
      // Limpar a mensagem de info
      showInfo("");
      
      // Mostrar uma mensagem no container de componentes
      if (componentsContainer) {
        componentsContainer.innerHTML = `
          <p class="info-message">As bibliotecas foram carregadas, mas podem estar incompletas.</p>
          <div class="component-item">
            <div class="library-label">${getTranslation(currentLanguage, 'variables_label')}</div>
            <div class="component-name">${getTranslation(currentLanguage, 'current_document_library')}</div>
            <div class="component-id">ID: documento-atual</div>
            <div class="library-name">${getTranslation(currentLanguage, 'library_type')}</div>
          </div>
        `;
      }
    }
    
    // Evento para o botão de recarregar - temporariamente desabilitado
    /* 
    refreshButton.addEventListener('click', () => {
      // Atualizar apenas os elementos que existem
      if (componentsContainer) {
        componentsContainer.innerHTML = `<p class="no-components">${getTranslation(currentLanguage, 'searching_libraries')}</p>`;
      }
      
      // Esconder mensagens de erro e mostrar mensagem de info
      hideError();
      showInfo(getTranslation(currentLanguage, 'reloading_libraries'));
      
      // Mostrar loading overlay
      showLoadingOverlay(getTranslation(currentLanguage, 'reloading_libraries'));
      
      // Limpar qualquer timeout existente
      if (libraryLoadingTimeout) {
        clearTimeout(libraryLoadingTimeout);
      }
      
      if (forceDisplayTimeout) {
        clearTimeout(forceDisplayTimeout);
      }
      
      // Configurar um novo timeout para o erro (20 segundos)
      libraryLoadingTimeout = setTimeout(handleLibraryLoadingTimeout, 20000);
      
      // Configurar um timeout para forçar a exibição mesmo sem resposta (10 segundos)
      forceDisplayTimeout = setTimeout(forceDisplayLibraries, 10000);
      
      // Enviar mensagem para recarregar
      parent.postMessage({ pluginMessage: { type: 'recarregar' } }, '*');
      
      console.log('[UI] Solicitação de recarregamento de bibliotecas enviada');
    });
    */
    
    // Adicionar tooltip explicando que o botão está desabilitado temporariamente
    refreshButton.addEventListener('mouseover', () => {
      refreshButton.title = "Funcionalidade temporariamente desabilitada";
    });

    // Evento para o seletor de bibliotecas
    if (librarySelect) {
    librarySelect.addEventListener('change', () => {
      const selectedLibraryId = librarySelect.value;
      
      if (!selectedLibraryId) {
        showCollectionsLoading();
        return;
      }
      
      // Limpar e mostrar loading
      clearCollectionsList();
      showCollectionsLoading();
      collectionsLoading.textContent = getTranslation(currentLanguage, 'loading_collections');
      
      // Solicitar coleções da biblioteca selecionada
      parent.postMessage({ 
        pluginMessage: { 
          type: 'carregarColecoes', 
          libraryId: selectedLibraryId
        } 
      }, '*');
    });
    }
    
      // Evento para o seletor de bibliotecas da aba Update Collections
    librarySelectUpdate.addEventListener('change', updatePreview);
    
    // Evento para o seletor de coleções locais
    localCollectionSelect.addEventListener('change', updatePreview);
    
    // Evento para o botão de atualizar
    updateButton.addEventListener('click', () => {
      const libraryId = librarySelectUpdate.value;
      const localCollectionId = localCollectionSelect.value;
      
      if (!libraryId || !localCollectionId) {
        showErrorUpdate("Selecione uma biblioteca externa e uma coleção local");
        return;
      }
      
      // Verificar e enviar os dados para o plugin
      hideErrorUpdate();
      showInfoUpdate("Iniciando substituição de variáveis...");
      updateButton.disabled = true;
      
      // Se tivermos correspondências disponíveis, use-as para substituir
      if (window.matchesData && window.matchesData.length > 0) {
        // Enviar solicitação para substituir as variáveis na coleção
        parent.postMessage({ 
          pluginMessage: { 
            type: 'substituirVariaveisEmColecao',
            matches: window.matchesData
          } 
        }, '*');
      } else {
        showErrorUpdate("Nenhuma correspondência encontrada para substituir");
        updateButton.disabled = false;
      }
    });
    
      // Evento para o seletor de bibliotecas da aba Update Variables
      librarySelectVar.addEventListener('change', () => {
        const selectedLibraryId = librarySelectVar.value;
        
        if (!selectedLibraryId) {
        // Reset do select de coleções
        collectionSelectVar.innerHTML = '<option value="">Selecione uma biblioteca primeiro</option>';
        collectionSelectVar.disabled = true;
        
          previewContentVar.textContent = "Ainda não há nada para pré-visualizar.\nSelecione uma biblioteca.";
          updateButtonVar.disabled = true;
          return;
        }
        
      // Reset do select de coleções e mostrar loading
      collectionSelectVar.innerHTML = `<option value="">${getTranslation(currentLanguage, 'loading_collections')}</option>`;
      collectionSelectVar.disabled = true;
      
      // Limpar a prévia
      previewContentVar.textContent = getTranslation(currentLanguage, 'loading_library_collections');
      loadingPreviewVar.style.display = 'block';
      updateButtonVar.disabled = true;
        
        // Solicitar coleções da biblioteca selecionada
        parent.postMessage({ 
          pluginMessage: { 
            type: 'carregarColecoes', 
            libraryId: selectedLibraryId
          } 
        }, '*');
      });
    
    // Evento para o seletor de coleções
    collectionSelectVar.addEventListener('change', () => {
      const selectedCollectionId = collectionSelectVar.value;
      
      if (!selectedCollectionId) {
        previewContentVar.textContent = t('select_collection_preview');
        updateButtonVar.disabled = true;
        return;
      }
      
      // Atualizar a prévia com a nova coleção selecionada
      updatePreviewVar();
    });
      
      // Adicionar event listeners aos botões de rádio para atualizar a prévia
      document.querySelectorAll('input[name="scope"]').forEach(radio => {
        radio.addEventListener('change', updatePreviewVar);
      });
      
      // Evento para o botão de atualizar - REMOVIDO PARA USAR APENAS O MODAL DE CONFIRMAÇÃO
      
      // Função para verificar se a biblioteca e coleção estão selecionadas e habilitar o botão
      function updatePreviewVar() {
        const libraryId = librarySelectVar.value;
        const collectionId = collectionSelectVar.value;
        
        if (!libraryId || !collectionId) {
          updateButtonVar.disabled = true;
          return;
        }
        
        // Habilitar o botão de substituir se ambos estiverem selecionados
        updateButtonVar.disabled = false;
      }
      
      // Função para mostrar erro na aba Update Variables
      function showErrorVar(message) {
        errorContainerVar.textContent = message || "Ocorreu um erro desconhecido";
        errorContainerVar.style.display = "block";
      }
      
      // Função para esconder erro na aba Update Variables
      function hideErrorVar() {
        errorContainerVar.style.display = "none";
      }
      
      // Função para mostrar informação na aba Update Variables
      function showInfoVar(message) {
        infoContainerVar.textContent = message || "";
        infoContainerVar.style.display = message ? "block" : "none";
      }
      
      // Função para formatar a lista de variáveis
      function formatVariablesList(variables) {
        if (!variables || variables.length === 0) {
        return '<p>Nenhuma variável ou estilo encontrado nos elementos selecionados.</p>';
      }
      
      // Calcular quantos itens têm match vs quantos não têm
      const matchCount = variables.filter(v => v.hasMatch).length;
      const totalCount = variables.length;
      
      // Iniciar HTML com o resumo
      let html = `<p><strong>${matchCount} de ${totalCount}</strong> itens têm correspondência na coleção selecionada.</p>`;
      
      // Organizar variáveis por tipo
      const variablesByType = {
        colors: variables.filter(v => v.type === 'COLOR' && v.isRealVariable === true),
          fills: variables.filter(v => v.property === 'fill'),
          strokes: variables.filter(v => v.property === 'stroke'),
        numbers: variables.filter(v => v.type === 'FLOAT'),
        texts: variables.filter(v => v.type === 'STRING'),
          effects: variables.filter(v => v.property === 'effect'),
          textStyles: variables.filter(v => v.property === 'text'),
          grids: variables.filter(v => v.property === 'grid')
        };

      // Adicionar cada tipo de variável
      for (const [type, vars] of Object.entries(variablesByType)) {
        if (vars.length === 0) continue;
        
        // Determinar o título com base no tipo
        let title = '';
        switch (type) {
          case 'colors': title = 'Variáveis de Cor'; break;
          case 'fills': title = 'Preenchimentos'; break;
          case 'strokes': title = 'Bordas'; break;
          case 'numbers': title = 'Variáveis Numéricas'; break;
          case 'texts': title = 'Variáveis de Texto'; break;
          case 'effects': title = 'Efeitos'; break;
          case 'textStyles': title = 'Estilos de Texto'; break;
          case 'grids': title = 'Grids de Layout'; break;
          default: title = 'Outros'; break;
        }
        
        // Calcular quantos itens deste tipo têm match
        const typeMatchCount = vars.filter(v => v.hasMatch).length;
        
        html += `<h4>${title} (${typeMatchCount}/${vars.length})</h4>`;
        
        vars.forEach((v, idx) => {
          // Adicionar indicador visual de match/unmatch no início da linha
          const matchIndicator = v.hasMatch ? 
            '<span class="match-indicator" style="color: green; margin-right: 4px;">match</span>' : 
            '<span class="match-indicator" style="color: red; margin-right: 4px;">unmatch</span>';
          
          html += `${matchIndicator} ${v.name}<br>`;
        });
      }
      
      return html;
      }

      // Variável para armazenar as variáveis completas por grupo
      let variablesByGroup = {};

      // Evento de clique no botão de procurar variáveis - removido pois a funcionalidade foi movida para o botão de substituir

      // Manipulador de mensagens do plugin
    window.onmessage = async (event) => {
        const message = event.data.pluginMessage;
        console.log(currentLanguage === 'en' ? 'Message received:' : 'Mensagem recebida:', message);

        if (!message) return;

        switch (message.type) {
          case 'language-preference':
            // Recebe a preferência de idioma salva
            if (message.language) {
              console.log('Preferência de idioma recebida:', message.language);
              currentLanguage = message.language;
              
              // Atualiza o seletor de idioma
              const languageSelect = document.getElementById('language-select');
              if (languageSelect) {
                languageSelect.value = currentLanguage;
              }
              
              // Aplica as traduções
              updateUILanguage();
              updateTabContent();
              updateDynamicContent();
            }
            break;
            
          case 'theme-preference':
            // Recebe a preferência de tema salva
            if (message.theme) {
              console.log('Preferência de tema recebida:', message.theme);
              
              // Atualiza o seletor de tema
              const themeSelect = document.getElementById('theme-select');
              if (themeSelect) {
                themeSelect.value = message.theme;
              }
              
              // Aplica o tema
              applyTheme(message.theme);
            }
            break;
            
          case 'figma-theme':
            // Recebe o tema do Figma
            if (message.theme && currentTheme === 'default') {
              console.log('Tema do Figma recebido:', message.theme);
              
              // Aplica o tema do Figma se estiver usando o tema padrão
              if (message.theme === 'dark') {
                document.body.classList.add('dark-theme');
              } else {
                document.body.classList.remove('dark-theme');
              }
            }
            break;
            
          case 'variables-found':
            updateButtonVar.disabled = false;
            // Armazena as variáveis encontradas para uso posterior
            foundVariables = message.variables;
            
            // Organiza as variáveis por grupo para o carregamento posterior
            variablesByGroup = {
            colors: foundVariables.filter(v => v.type === 'COLOR' && v.isRealVariable === true),
              numbers: foundVariables.filter(v => v.type === 'FLOAT'),
              texts: foundVariables.filter(v => v.type === 'STRING'),
              booleans: foundVariables.filter(v => v.type === 'BOOLEAN'),
              fills: foundVariables.filter(v => v.property === 'fill'),
              strokes: foundVariables.filter(v => v.property === 'stroke'),
              effects: foundVariables.filter(v => v.property === 'effect'),
              textStyles: foundVariables.filter(v => v.property === 'text'),
              grids: foundVariables.filter(v => v.property === 'grid')
            };
            
            // Esconde o loading
            loadingPreviewVar.style.display = 'none';
            hideLoadingOverlay();
            
            // Mostra o modal de confirmação diretamente
            showConfirmModal();
            break;

          case 'no-variables-found':
            updateButtonVar.disabled = true;
            // Limpa as variáveis encontradas
            foundVariables = [];
            variablesByGroup = {};
            // Esconde o loading
            loadingPreviewVar.style.display = 'none';
            hideLoadingOverlay();
            // Show error message with language-aware text
            showErrorVar(currentLanguage === 'en' ? 
              'No variables or styles found in the selected elements.' : 
              'Nenhuma variável ou estilo encontrado nos elementos selecionados.');
            break;
            
          case 'preview-correspondencias':
            // Atualizar a pré-visualização das correspondências
            if (message.hasMatches) {
              // Armazenar as correspondências para usar na substituição
              window.matchesData = message.matches;
              
              updateButton.disabled = false;
              
              // Reiniciar estado da paginação
              window.paginationState = {
                currentPage: 1,
                itemsPerPage: 30,
                showingAll: false
              };
              
              // Atualizar a exibição usando a função de paginação
              updateMatchesDisplay();
            } else {
              // Limpar as correspondências armazenadas
              window.matchesData = [];
              
              updateButton.disabled = true;
              previewContent.innerHTML = `<p class="warning">${message.message || t('no_matches_found')}</p>`;
              if (message.error) {
                previewContent.innerHTML += `<p class="error">${t('error')}: ${message.error}</p>`;
              }
            }
            break;
            
        case 'collections-data':
          // Preencher o select de coleções
          if (message.collections && Array.isArray(message.collections)) {
            collectionSelectVar.innerHTML = '<option value="">Selecione uma coleção</option>';
            
              message.collections.forEach(collection => {
                const option = document.createElement('option');
                option.value = collection.id;
              option.textContent = collection.name;
              collectionSelectVar.appendChild(option);
            });
            
            collectionSelectVar.disabled = false;
            
            if (message.collections.length === 0) {
              collectionSelectVar.innerHTML = '<option value="">Nenhuma coleção encontrada</option>';
              collectionSelectVar.disabled = true;
            }
          } else {
            collectionSelectVar.innerHTML = '<option value="">Nenhuma coleção encontrada</option>';
            collectionSelectVar.disabled = true;
          }
          
          loadingPreviewVar.style.display = 'none';
          previewContentVar.textContent = t('select_collection_preview');
            break;

          case 'libraries-data':
          // Limpar os timeouts quando os dados chegarem
          if (libraryLoadingTimeout) {
            clearTimeout(libraryLoadingTimeout);
            libraryLoadingTimeout = null;
          }
          
          if (forceDisplayTimeout) {
            clearTimeout(forceDisplayTimeout);
            forceDisplayTimeout = null;
          }
          
          // Esconder o loading overlay
          hideLoadingOverlay();
          
          // Limpar a mensagem de info
          showInfo("");
          
          console.log('[UI] Dados de bibliotecas recebidos:', message.libraries);
          const libraries = message.libraries || [];
          
          // Verificar se há uma mensagem de erro
          if (message.error) {
            showError(message.error);
            if (componentsContainer) {
              componentsContainer.innerHTML = `<p class="error-message">${getTranslation(currentLanguage, 'failed_load_libraries')}</p>`;
            }
            return;
          }
          
          // Limpar e preencher o select com as bibliotecas
          if (librarySelect) librarySelect.innerHTML = '';
          librarySelectUpdate.innerHTML = '';
          librarySelectVar.innerHTML = '';
          
          // Adicionar opção padrão
          const defaultOption = document.createElement('option');
          defaultOption.value = '';
          defaultOption.textContent = libraries.length > 0 
            ? (currentLanguage === 'en' ? 'Select a library...' : 'Selecione uma biblioteca...') 
            : (currentLanguage === 'en' ? 'No libraries available' : 'Nenhuma biblioteca disponível');
          
          if (librarySelect) librarySelect.appendChild(defaultOption.cloneNode(true));
          librarySelectUpdate.appendChild(defaultOption.cloneNode(true));
          librarySelectVar.appendChild(defaultOption.cloneNode(true));
          
          // Adicionar opções para cada biblioteca
          libraries.forEach(library => {
            const option = document.createElement('option');
            option.value = library.id;
            option.textContent = library.name;
            
            if (librarySelect) librarySelect.appendChild(option.cloneNode(true));
            librarySelectUpdate.appendChild(option.cloneNode(true));
            librarySelectVar.appendChild(option.cloneNode(true));
          });
          
          // Mostrar bibliotecas no container principal
          componentsContainer.innerHTML = '';
          
          if (!libraries || libraries.length === 0) {
            componentsContainer.innerHTML = `<p class="no-components">${currentLanguage === 'en' ? 'No libraries found in this file' : 'Não foram encontradas bibliotecas neste arquivo'}</p>`;
            showInfo(currentLanguage === 'en' ? "No libraries found in the current document." : "Nenhuma biblioteca encontrada no documento atual.");
            return;
          }
          
          libraries.forEach((library) => {
              if (!library) return;
            
            const libraryElement = document.createElement('div');
            libraryElement.className = 'component-item';
            
            const labelElement = document.createElement('span');
            labelElement.className = 'library-label library-type';
            // Traduzir o tipo da biblioteca de acordo com o idioma atual
            if (library.type === 'Variáveis' || library.type === 'Variables') {
              labelElement.textContent = currentLanguage === 'en' ? 'Variables' : 'Variáveis';
            } else if (library.type === 'Componentes' || library.type === 'Components') {
              labelElement.textContent = currentLanguage === 'en' ? 'Components' : 'Componentes';
            } else {
              labelElement.textContent = library.type || (currentLanguage === 'en' ? 'Library' : 'Biblioteca');
            }
            libraryElement.appendChild(labelElement);
            
            const nameElement = document.createElement('div');
            nameElement.className = 'component-name';
            nameElement.textContent = library.name || (currentLanguage === 'en' ? 'Unnamed library' : 'Biblioteca sem nome');
            libraryElement.appendChild(nameElement);
            
            const idElement = document.createElement('div');
            idElement.className = 'component-id';
            idElement.textContent = `ID: ${library.id || (currentLanguage === 'en' ? 'Unknown' : 'Desconhecido')}`;
            libraryElement.appendChild(idElement);
            
            if (library.library) {
              const typeElement = document.createElement('div');
              typeElement.className = 'library-name component-id';
              // Traduzir o nome da biblioteca de acordo com o idioma atual
              if (library.library === 'Biblioteca de Variáveis' || library.library === 'Variable Library') {
                typeElement.textContent = currentLanguage === 'en' ? 'Variable Library' : 'Biblioteca de Variáveis';
              } else if (library.library === 'Biblioteca de Componentes' || library.library === 'Component Library') {
                typeElement.textContent = currentLanguage === 'en' ? 'Component Library' : 'Biblioteca de Componentes';
              } else {
                typeElement.textContent = library.library;
              }
              libraryElement.appendChild(typeElement);
            }
            
            componentsContainer.appendChild(libraryElement);
          });
            break;

        case 'local-collections-data':
          // Atualizar o dropdown de coleções locais
          localCollectionSelect.innerHTML = '';
          
          if (!message.collections || message.collections.length === 0) {
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = currentLanguage === 'en' ? 'No local collections available' : 'Nenhuma coleção local disponível';
            localCollectionSelect.appendChild(defaultOption);
            showErrorUpdate(currentLanguage === 'en' ? 'No local collections found. Create local variable collections first.' : 'Nenhuma coleção local encontrada. Crie coleções de variáveis locais primeiro.');
          } else {
            // Adicionar opção padrão
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = currentLanguage === 'en' ? 'Select a local collection...' : 'Selecione uma coleção local...';
            localCollectionSelect.appendChild(defaultOption);
            
            // Adicionar opções para cada coleção
            message.collections.forEach(collection => {
              const option = document.createElement('option');
              option.value = collection.id;
              option.textContent = collection.name;
              localCollectionSelect.appendChild(option);
            });
            
            hideErrorUpdate();
          }
          
          // Atualizar a prévia se ambos os seletores tiverem valores
          if (librarySelectUpdate.value && localCollectionSelect.value) {
            updatePreview();
          }
          break;
          
          case 'update-collections-result':
            // Atualizar o resultado da substituição de variáveis na coleção usando o sistema de tradução
            if (message.success) {
              if (message.messageKey === 'success_updated_with_errors') {
                showInfoUpdate(t('success_updated_with_errors', {count: message.count, errors: message.errors}));
              } else {
                showInfoUpdate(t('success_updated', {count: message.count}));
              }
            } else {
              if (message.messageKey === 'failed_update_variables') {
                showErrorUpdate(t('failed_update_variables', {errors: message.errors}));
              } else if (message.message) {
                showErrorUpdate(message.message);
              } else {
                showErrorUpdate(t('error_generic'));
              }
            }
            updateButton.disabled = false;
            break;

        case 'substituicao-concluida':
          // Atualizar o resultado da substituição de variáveis
          updateButtonVar.disabled = false;
          loadingPreviewVar.style.display = 'none';
          hideLoadingOverlay();
          
          if (message.success) {
            showInfoVar(message.message || "Substituição concluída com sucesso!");
          } else {
            showErrorVar(message.message || "Erro ao substituir variáveis");
          }
          break;
        }
      };
      
      // Informa ao plugin que a UI está pronta
      parent.postMessage({ pluginMessage: { type: 'ui-ready' } }, '*');
      
      // Solicita especificamente as coleções locais
      setTimeout(() => {
        parent.postMessage({ pluginMessage: { type: 'carregarColecoesLocais' } }, '*');
      }, 500);

    // Manipulador para o botão "carregar mais"
      function handleLoadMoreClick(event) {
      // Evita a propagação do evento
      event.preventDefault();
      event.stopPropagation();
      
      // Obtém o botão clicado
        const button = event.target;
      const groupId = button.getAttribute('data-group');
      const groupType = button.getAttribute('data-type');
      
      // Obtém o elemento pai (li) e o elemento ul
      const liElement = button.closest('li');
      const ulElement = liElement.parentElement;
      
      // Remove o botão "carregar mais"
      liElement.remove();
      
      // Obtém os itens do grupo
      const items = variablesByGroup[groupType];
      if (!items || items.length <= 5) return;
      
      // Adiciona os itens restantes
      for (let i = 5; i < items.length; i++) {
        const item = items[i];
        const li = document.createElement('li');
        
        // Adicionar indicador de correspondência
        const matchIndicator = item.hasMatch ? 
          `<span class="match-indicator" style="color: green; margin-right: 4px;">${getTranslation(currentLanguage, 'match')}</span>` : 
          `<span class="match-indicator" style="color: red; margin-right: 4px;">${getTranslation(currentLanguage, 'unmatch')}</span>`;
          
        li.innerHTML = `
          ${matchIndicator}
            <span class="var-name" title="${item.name}">${item.name}</span>
          ${groupType !== 'colors' && groupType !== 'numbers' ? `<span class="var-type ${groupType.slice(0, -1)}">${item.type}</span>` : ''}
            ${item.collection ? `<span class="var-collection" title="${item.collection}">${item.collection}</span>` : ''}
        `;
        ulElement.appendChild(li);
      }
      
      // Adiciona um botão para mostrar menos, se necessário
      const liCollapse = document.createElement('li');
      liCollapse.className = 'more-items';
      liCollapse.innerHTML = `
        <button class="load-more-button" data-group="${groupId}" data-type="${groupType}" data-action="collapse">
          ${getTranslation(currentLanguage, 'show_less')}
        </button>
      `;
      ulElement.appendChild(liCollapse);
      
      // Adiciona manipulador de evento para o botão "mostrar menos"
      const collapseButton = liCollapse.querySelector('button');
      collapseButton.addEventListener('click', handleCollapseClick);
    }

    // Manipulador para o botão "mostrar menos"
    function handleCollapseClick(event) {
      // Evita a propagação do evento
      event.preventDefault();
      event.stopPropagation();
      
      // Obtém o botão clicado
      const button = event.target;
      const groupId = button.getAttribute('data-group');
      const groupType = button.getAttribute('data-type');
      
      // Obtém o elemento ul
      const ulElement = button.closest('ul');
      
      // Remove todos os elementos li após o quinto
      const allItems = Array.from(ulElement.querySelectorAll('li'));
      for (let i = 5; i < allItems.length; i++) {
        allItems[i].remove();
      }
      
      // Adiciona novamente o botão "carregar mais"
      const liMore = document.createElement('li');
      liMore.className = 'more-items';
      const items = variablesByGroup[groupType];
      liMore.innerHTML = `
            <button class="load-more-button" data-group="${groupId}" data-type="${groupType}">
          ${getTranslation(currentLanguage, 'show_more_items', {count: items.length - 5})}
            </button>
          `;
      ulElement.appendChild(liMore);
      
      // Adiciona manipulador de evento para o novo botão "mostrar mais"
      const moreButton = liMore.querySelector('button');
      moreButton.addEventListener('click', handleLoadMoreClick);
      }

      // Função para formatar e mostrar as correspondências com paginação
      function formatMatchesList(matches, page = 1, itemsPerPage = 30) {
        // Agrupar correspondências por nome de variável local
        const groupedMatches = {};
        matches.forEach(match => {
          if (!groupedMatches[match.localName]) {
            groupedMatches[match.localName] = [];
          }
          groupedMatches[match.localName].push(match);
        });
        
        // Transformar o objeto agrupado em array para paginação
        const groupedArray = Object.keys(groupedMatches).map(varName => {
          return {
            name: varName,
            matches: groupedMatches[varName]
          };
        });
        
        // Calcular páginas e total
        const totalItems = groupedArray.length;
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        
        // Garantir que a página está dentro dos limites
        page = Math.max(1, Math.min(page, totalPages || 1));
        
        // Índices para seleção
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, totalItems);
        
        // Selecionar itens da página atual
        const currentItems = groupedArray.slice(startIndex, endIndex);
        
        // Construir HTML
        let html = ``;
        html += `<div class="matches-count">${t('found_matches', {count: totalItems})}</div>`;
        
        // Conteúdo principal
        html += '<div class="matches-container">';
        
        if (currentItems.length === 0) {
          html += `<p>${t('no_matches_found')}</p>`;
            } else {
          currentItems.forEach(group => {
            html += `
              <div class="match-item">
                <div class="variavel">${group.name}</div>
                
                <div class="modes-container">
                  <div class="modes-title">${t('modes')}</div>
                  <div class="modes-list">
            `;
            
            // Verificar se há informações de modos
            if (group.matches[0].modes && group.matches[0].modes.length > 0) {
              group.matches[0].modes.forEach(mode => {
                html += `
                  <div class="mode-row">
                    <span class="mode-name">${mode.name}</span>
                    <span class="mode-value">${mode.value}</span>
                  </div>
                `;
              });
          } else {
              // Fallback para exibir pelo menos o tipo da variável se não houver informações de modo
              html += `
                <div class="mode-row">
                  <span class="mode-name">modeName</span>
                  <span class="mode-value">variableValue</span>
                </div>
                <div class="mode-row">
                  <span class="mode-name">modeName</span>
                  <span class="mode-value">variableValue</span>
                </div>
              `;
            }
            
            html += `
                  </div>
                </div>
              </div>
            `;
          });
        }
        
        html += '</div>';
        
        // Informações de paginação simplificadas
        if (totalPages > 1) {
          html += `
            <div class="matches-pagination">
              <span>Página ${page} de ${totalPages}</span>
              ${page > 1 ? '<button class="pagination-button" id="prev-page">Próxima</button>' : ''}
              <button class="pagination-button" id="show-more">Ver Mais 30</button>
              <button class="pagination-button" id="show-all">Ver Todas</button>
            </div>
          `;
        }
        
        return html;
      }

      // Inicializar variáveis de paginação
      window.paginationState = {
        currentPage: 1,
        itemsPerPage: 30,
        showingAll: false
      };

      // Adicionar função para configurar os eventos da paginação
      function setupPaginationEvents() {
        // Botão Ver Anterior
        const prevButton = document.getElementById('prev-page');
        if (prevButton) {
          prevButton.addEventListener('click', () => {
            window.paginationState.currentPage--;
            updateMatchesDisplay();
          });
        }
        
        // Botão Ver Mais 30
        const showMoreButton = document.getElementById('show-more');
        if (showMoreButton) {
          showMoreButton.addEventListener('click', () => {
            window.paginationState.itemsPerPage += 30;
            updateMatchesDisplay();
          });
        }
        
        // Botão Ver Todas
        const showAllButton = document.getElementById('show-all');
        if (showAllButton) {
          showAllButton.addEventListener('click', () => {
            window.paginationState.showingAll = true;
            updateMatchesDisplay();
          });
        }
      }

      // Função para atualizar a exibição de correspondências
      function updateMatchesDisplay() {
        if (!window.matchesData || !Array.isArray(window.matchesData)) {
          previewContent.innerHTML = `<p class="warning">${getTranslation(currentLanguage, 'no_matches_available')}</p>`;
          return;
        }
        
        // Se estiver mostrando todas
        if (window.paginationState.showingAll) {
          previewContent.innerHTML = formatMatchesList(
            window.matchesData, 
            1, 
            window.matchesData.length
          );
        } else {
          previewContent.innerHTML = formatMatchesList(
            window.matchesData, 
            window.paginationState.currentPage,
            window.paginationState.itemsPerPage
          );
        }
        
        // Configurar eventos após atualizar o conteúdo
        setupPaginationEvents();
      }

    // Elemento do modal
    const confirmModal = document.getElementById('confirm-modal');
    const modalVariablesList = document.getElementById('modal-variables-list');
    const modalCancel = document.getElementById('modal-cancel');
    const modalConfirm = document.getElementById('modal-confirm');

    // Função para procurar variáveis e estilos (agora chamada pelo botão de substituir)
    function searchVariablesAndShowModal() {
      // Verificar se uma biblioteca e coleção foram selecionadas
      if (!librarySelectVar.value) {
        showErrorVar("Por favor, selecione uma biblioteca de referência primeiro.");
        return;
      }
      
      if (!collectionSelectVar.value) {
        showErrorVar("Por favor, selecione uma coleção de referência primeiro.");
        return;
      }
      
      // Mostrar o loading
      loadingPreviewVar.style.display = 'block';
      // Esconder o erro
      hideErrorVar();
      // Desabilitar o botão enquanto procura
      updateButtonVar.disabled = true;
      
      // Obter o escopo selecionado
      const scopeRadio = document.querySelector('input[name="scope"]:checked');
      const scope = scopeRadio ? scopeRadio.value : 'selection';
      
      // Limpar variáveis encontradas
      foundVariables = [];
      
      // Mostrar loading overlay
      showLoadingOverlay("Procurando variáveis e estilos...");
      
      // Enviar mensagem para o plugin
      parent.postMessage({ 
        pluginMessage: { 
          type: 'search-variables',
          scope: scope,
          libraryId: librarySelectVar.value,
          collectionId: collectionSelectVar.value,
          matchByName: true,
          checkMatch: true
        } 
      }, '*');
    }
    
    // Função para formatar a lista de variáveis para exibição
    function formatVariablesList(variables) {
      if (!variables || variables.length === 0) {
        return '<p>Nenhuma variável ou estilo encontrado nos elementos selecionados.</p>';
      }
      
      // Calcular quantos itens têm match vs quantos não têm
      const matchCount = variables.filter(v => v.hasMatch).length;
      const totalCount = variables.length;
      
      // Iniciar HTML com o resumo
      let html = `<p><strong>${matchCount} de ${totalCount}</strong> itens têm correspondência na coleção selecionada.</p>`;
      
      // Organizar variáveis por tipo
      const variablesByType = {
        colors: variables.filter(v => v.type === 'COLOR' && v.isRealVariable === true),
        fills: variables.filter(v => v.property === 'fill'),
        strokes: variables.filter(v => v.property === 'stroke'),
        numbers: variables.filter(v => v.type === 'FLOAT'),
        texts: variables.filter(v => v.type === 'STRING'),
        effects: variables.filter(v => v.property === 'effect'),
        textStyles: variables.filter(v => v.property === 'text'),
        grids: variables.filter(v => v.property === 'grid')
      };
      
      // Adicionar cada tipo de variável
      for (const [type, vars] of Object.entries(variablesByType)) {
        if (vars.length === 0) continue;
        
        // Determinar o título com base no tipo
        let title = '';
        switch (type) {
          case 'colors': title = 'Variáveis de Cor'; break;
          case 'fills': title = 'Preenchimentos'; break;
          case 'strokes': title = 'Bordas'; break;
          case 'numbers': title = 'Variáveis Numéricas'; break;
          case 'texts': title = 'Variáveis de Texto'; break;
          case 'effects': title = 'Efeitos'; break;
          case 'textStyles': title = 'Estilos de Texto'; break;
          case 'grids': title = 'Grids de Layout'; break;
          default: title = 'Outros'; break;
        }
        
        // Calcular quantos itens deste tipo têm match
        const typeMatchCount = vars.filter(v => v.hasMatch).length;
        
        html += `<h4>${title} (${typeMatchCount}/${vars.length})</h4>`;
        
        vars.forEach((v, idx) => {
          // Adicionar indicador visual de match/unmatch no início da linha
          const matchIndicator = v.hasMatch ? 
            '<span class="match-indicator" style="color: green; margin-right: 4px;">match</span>' : 
            '<span class="match-indicator" style="color: red; margin-right: 4px;">unmatch</span>';
          
          html += `${matchIndicator} ${v.name}<br>`;
        });
      }
      
      return html;
    }
    
    // Function to show the confirmation modal with variables to be replaced
    function showConfirmModal() {
      if (!foundVariables || foundVariables.length === 0) {
        showErrorVar(currentLanguage === 'en' ? 
          "No variables found to replace." : 
          "Nenhuma variável encontrada para substituir.");
        return;
      }
      
      // Update modal title and description based on current language
      const modalTitle = document.querySelector('.modal-title');
      const modalDescription = document.querySelector('#confirm-modal .modal-content > p:first-child');
      const modalNote = document.querySelector('.modal-note');
      
      if (modalTitle) {
        modalTitle.textContent = currentLanguage === 'en' ? 
          'Confirm Variable Replacement' : 
          'Confirmar Substituição de Variáveis';
      }
      
      if (modalDescription) {
        modalDescription.textContent = currentLanguage === 'en' ? 
          'You are about to replace the following variables and styles:' : 
          'Você está prestes a substituir as seguintes variáveis e estilos:';
      }
      
      if (modalNote) {
        modalNote.textContent = currentLanguage === 'en' ? 
          'Note: The replacement will only be applied to the selected scope.' : 
          'Nota: A substituição será aplicada apenas ao escopo selecionado.';
      }
      
      // Update buttons
      const cancelButton = document.querySelector('#modal-cancel');
      const confirmButton = document.querySelector('#modal-confirm');
      
      if (cancelButton) {
        cancelButton.textContent = currentLanguage === 'en' ? 'Cancel' : 'Cancelar';
      }
      
      if (confirmButton) {
        confirmButton.textContent = currentLanguage === 'en' ? 
          'Confirm Replacement' : 
          'Confirmar Substituição';
      }
      
      // Limpar a lista de variáveis do modal
      modalVariablesList.innerHTML = '';
      
      // Adicionar debug para entender a estrutura das variáveis
      console.log('Todas as variáveis encontradas:', foundVariables);
      
      // Identificar variáveis reais (não estilos)
      // Primeiro tentamos filtrar apenas variáveis com type definido
      let realVariables = foundVariables.filter(v => 
        v.type && (v.type === 'COLOR' || v.type === 'FLOAT' || v.type === 'STRING' || v.type === 'BOOLEAN')
      );
      
      // Se não encontrarmos nenhuma variável com o filtro acima, usamos todas as variáveis
      if (realVariables.length === 0) {
        console.log('Nenhuma variável encontrada com o filtro restritivo, usando todas as variáveis');
        realVariables = foundVariables;
      }
      
      console.log('Variáveis filtradas para exibição:', realVariables);
      
      // Classificar variáveis: correspondentes, sem correspondência e nativas
      const matchingVars = realVariables.filter(v => v.hasMatch && !v.isFromExternalLibrary);
      const nonMatchingVars = realVariables.filter(v => !v.hasMatch);
      const nativeVars = realVariables.filter(v => v.isFromExternalLibrary);
      
      console.log('Variáveis correspondentes:', matchingVars);
      console.log('Variáveis sem correspondência:', nonMatchingVars);
      console.log('Variáveis nativas:', nativeVars);
      
      // Adicionar variáveis correspondentes
      if (matchingVars.length > 0) {
        const matchingHeader = document.createElement('div');
        matchingHeader.className = 'modal-group-header';
        matchingHeader.innerHTML = `<strong>${
          currentLanguage === 'en' ? 
            `Variables to be replaced (${matchingVars.length})` : 
            `Variáveis a serem substituídas (${matchingVars.length})`
        }</strong>`;
        modalVariablesList.appendChild(matchingHeader);
        
        matchingVars.forEach(v => {
          const item = document.createElement('div');
          item.className = 'var-item';
          item.innerHTML = `
            <span class="var-name">${v.name}</span>
            <span class="modal-item-match">${
              currentLanguage === 'en' ? 'Will be replaced' : 'Será substituída'
            }</span>
          `;
          modalVariablesList.appendChild(item);
        });
      }
      
      // Adicionar variáveis nativas que não serão alteradas
      if (nativeVars.length > 0) {
        const nativeHeader = document.createElement('div');
        nativeHeader.className = 'modal-group-header';
        nativeHeader.innerHTML = `<strong>${
          currentLanguage === 'en' ? 
            `Native variables that won't be changed (${nativeVars.length})` : 
            `Variáveis nativas que não serão alteradas (${nativeVars.length})`
        }</strong>`;
        modalVariablesList.appendChild(nativeHeader);
        
        nativeVars.forEach(v => {
          const item = document.createElement('div');
          item.className = 'var-item';
          item.innerHTML = `
            <span class="var-name">${v.name}</span>
            <span class="modal-item-native">${
              currentLanguage === 'en' ? 'Already native' : 'Já é nativa'
            }</span>
          `;
          modalVariablesList.appendChild(item);
        });
      }
      
      // Adicionar variáveis sem correspondência
      if (nonMatchingVars.length > 0) {
        const nonMatchingHeader = document.createElement('div');
        nonMatchingHeader.className = 'modal-group-header';
        nonMatchingHeader.innerHTML = `<strong>${
          currentLanguage === 'en' ? 
            `Variables without matches (${nonMatchingVars.length})` : 
            `Variáveis sem correspondência (${nonMatchingVars.length})`
        }</strong>`;
        modalVariablesList.appendChild(nonMatchingHeader);
        
        nonMatchingVars.forEach(v => {
          const item = document.createElement('div');
          item.className = 'var-item';
          item.innerHTML = `
            <span class="var-name">${v.name}</span>
            <span class="modal-item-no-match">${
              currentLanguage === 'en' ? 'No match found' : 'Sem correspondência'
            }</span>
          `;
          modalVariablesList.appendChild(item);
        });
      }
      
      // Mostrar o modal
      confirmModal.classList.add('active');
    }
    
    // Evento para fechar o modal ao clicar em cancelar
    modalCancel.addEventListener('click', () => {
      confirmModal.classList.remove('active');
    });
    
    // Evento para confirmar a substituição
    modalConfirm.addEventListener('click', () => {
      // Esconder o modal
      confirmModal.classList.remove('active');
      
      // Mostrar loading e desabilitar botão
      loadingPreviewVar.style.display = 'block';
      updateButtonVar.disabled = true;
      
      // Obter o escopo selecionado
      const scopeRadio = document.querySelector('input[name="scope"]:checked');
      const scope = scopeRadio ? scopeRadio.value : 'selection';
      
      // Filtrar variáveis para substituição
      // Primeiro tentamos com um filtro mais restritivo
      let variablesToReplace = foundVariables.filter(v => 
        v.type && (v.type === 'COLOR' || v.type === 'FLOAT' || v.type === 'STRING' || v.type === 'BOOLEAN') && 
        v.hasMatch && !v.isFromExternalLibrary
      );
      
      // Se não encontrarmos nenhuma variável com o filtro acima, usamos todas as variáveis com correspondência
      if (variablesToReplace.length === 0) {
        console.log('Nenhuma variável encontrada para substituição com o filtro restritivo, usando todas as variáveis com match');
        variablesToReplace = foundVariables.filter(v => v.hasMatch && !v.isFromExternalLibrary);
      }
      
      console.log('Variáveis a serem substituídas:', variablesToReplace);
      
      // Mostrar o loading overlay antes de enviar a solicitação
      showLoadingOverlay(getTranslation(currentLanguage, 'processing_substitution'));
      
      // Enviar mensagem para o plugin com as variáveis a serem substituídas
      parent.postMessage({ 
        pluginMessage: { 
          type: 'substituir-variaveis',
          scope: scope,
          libraryId: librarySelectVar.value,
          collectionId: collectionSelectVar.value,
          variables: variablesToReplace
        } 
      }, '*');
    });
    
    // Evento para o botão de atualizar variáveis - agora também procura variáveis antes de mostrar o modal
    updateButtonVar.addEventListener('click', searchVariablesAndShowModal);

    // Evento para o botão de teste float
    document.getElementById('teste-float-btn')?.addEventListener('click', () => {
      // Desabilitar o botão durante o teste
      const testeBtn = document.getElementById('teste-float-btn');
      testeBtn.disabled = true;
      testeBtn.textContent = 'Testando...';
      
      // Limpar mensagens anteriores
      hideErrorVar();
      showInfoVar("Testando aplicação de variável FLOAT...");
      
      // Enviar mensagem para o plugin executar o teste
      parent.postMessage({ 
        pluginMessage: { 
          type: 'teste-float'
        } 
      }, '*');
    });

    // Adicionar manipulador para o resultado do teste de float
    window.addEventListener('message', function(event) {
      const message = event.data.pluginMessage;
      if (!message) return;
      
      if (message.type === 'teste-float-resultado') {
        // Reativar o botão
        const testeBtn = document.getElementById('teste-float-btn');
        testeBtn.disabled = false;
        testeBtn.textContent = 'Testar Float';
        
        if (message.success) {
          hideErrorVar();
          showInfoVar(message.message);
        } else {
          showErrorVar(message.message);
          hideInfoVar();
        }
      }
      
      // Adicionar resposta para a solicitação de biblioteca e coleção selecionadas
      if (message.type === 'solicitar-selecao-biblioteca-colecao') {
        const libraryId = librarySelectVar.value;
        const collectionId = collectionSelectVar.value;
        
        // Verificar se ambos estão selecionados
        if (!libraryId || !collectionId) {
          showErrorVar("Selecione uma biblioteca e uma coleção antes de testar");
          
          // Reativar o botão
          const testeBtn = document.getElementById('teste-float-btn');
          testeBtn.disabled = false;
          testeBtn.textContent = 'Testar Float';
          
          // Enviar resposta com erro
          parent.postMessage({
            pluginMessage: {
              type: 'resposta-selecao-biblioteca-colecao',
              success: false,
              error: 'Selecione uma biblioteca e uma coleção antes de testar'
            }
          }, '*');
          return;
        }
        
        // Enviar resposta com os valores selecionados
        parent.postMessage({
          pluginMessage: {
            type: 'resposta-selecao-biblioteca-colecao',
            success: true,
            libraryId: libraryId,
            collectionId: collectionId
          }
        }, '*');
      }
    });
    });
    
    // Funções para controlar o loading overlay
    function showLoadingOverlay(message = null) {
      const loadingOverlay = document.getElementById('loading-overlay');
      const loadingText = document.getElementById('loading-text');
      
      // Use provided message or default based on current language
      const defaultMessage = getTranslation(currentLanguage, 'processing');
      loadingText.textContent = message || defaultMessage;
      
      // Desabilitar todos os botões e inputs para evitar interações durante o processamento
      document.querySelectorAll('button, input, select').forEach(element => {
        if (!element.hasAttribute('data-disabled-state')) {
          element.setAttribute('data-disabled-state', element.disabled);
          element.disabled = true;
        }
      });
      
      // Mostrar o overlay
      loadingOverlay.classList.add('active');
      document.body.style.overflow = 'hidden'; // Prevenir scroll
    }
    
    function hideLoadingOverlay() {
      const loadingOverlay = document.getElementById('loading-overlay');
      
      // Restaurar o estado de habilitação dos elementos
      document.querySelectorAll('[data-disabled-state]').forEach(element => {
        element.disabled = element.getAttribute('data-disabled-state') === 'true';
        element.removeAttribute('data-disabled-state');
      });
      
      // Esconder o overlay
      loadingOverlay.classList.remove('active');
      document.body.style.overflow = ''; // Restaurar scroll
    }
    
    // Expor as funções globalmente para que possam ser chamadas de qualquer lugar
    window.showLoadingOverlay = showLoadingOverlay;
    window.hideLoadingOverlay = hideLoadingOverlay;

    // Settings functionality
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      initializeSettings();
    });
    
    // Initialize settings functionality
    function initializeSettings() {
      console.log('Initializing settings functionality');
      const settingsButton = document.getElementById('settings-button');
      const settingsOverlay = document.getElementById('settings-overlay');
      const settingsClose = document.getElementById('settings-close');
      const languageSelect = document.getElementById('language-select');
      
      if (!settingsButton || !settingsOverlay || !settingsClose) {
        console.error('Settings elements not found:', {
          button: !!settingsButton,
          overlay: !!settingsOverlay,
          close: !!settingsClose
        });
        return;
      }
      
      console.log('Settings elements found, adding event listeners');
      
      // Direct method to toggle settings overlay
      window.toggleSettings = function() {
        console.log('Toggle settings called');
        settingsOverlay.classList.toggle('active');
        return false; // Prevent default
      };
      
      // Open settings overlay
      settingsButton.onclick = function(e) {
        console.log('Settings button clicked');
        e.preventDefault();
        e.stopPropagation();
        settingsOverlay.classList.add('active');
        return false;
      };
      
      // Close settings overlay
      settingsClose.onclick = function() {
        console.log('Close button clicked');
        settingsOverlay.classList.remove('active');
        return false;
      };
      
      // Cancel button
      const settingsCancel = document.getElementById('settings-cancel');
      if (settingsCancel) {
        settingsCancel.onclick = function() {
          console.log('Cancel button clicked');
          settingsOverlay.classList.remove('active');
          return false;
        };
      }
      
      // Update settings button
      const settingsUpdate = document.getElementById('settings-update');
      if (settingsUpdate) {
        settingsUpdate.onclick = function() {
          console.log('Update settings button clicked');
          const languageSelect = document.getElementById('language-select');
          const themeSelect = document.getElementById('theme-select');
          const selectedLanguage = languageSelect ? languageSelect.value : 'pt-br';
          const selectedTheme = themeSelect ? themeSelect.value : 'default';
          console.log(`Saving language setting: ${selectedLanguage}`);
          console.log(`Saving theme setting: ${selectedTheme}`);
          
          // Only update the language and refresh UI after clicking Save
          currentLanguage = selectedLanguage;
          
          // Apply all translations
          updateUILanguage();
          updateTabContent();
          updateDynamicContent();
          
          // Apply the selected theme
          applyTheme(selectedTheme);
          
          // Recarregar as bibliotecas para atualizar os textos
          parent.postMessage({
            pluginMessage: {
              type: 'reload-libraries'
            }
          }, '*');
          
          // In Figma plugin, we would save to clientStorage
          try {
            // Send message to plugin code to save the preferences
            parent.postMessage({
              pluginMessage: {
                type: 'save-language-preference',
                language: selectedLanguage
              }
            }, '*');
            
            parent.postMessage({
              pluginMessage: {
                type: 'save-theme-preference',
                theme: selectedTheme
              }
            }, '*');
            
            console.log('Settings saved successfully');
          } catch (error) {
            console.error('Error saving preferences:', error);
          }
          
          // Close the overlay
          settingsOverlay.classList.remove('active');
          return false;
        };
      }
      
      // Close settings when clicking outside the settings container
      settingsOverlay.onclick = function(e) {
        if (e.target === settingsOverlay) {
          console.log('Clicked outside settings container');
          settingsOverlay.classList.remove('active');
        }
        return true;
      };
    }
    
    // Initialize settings immediately as well
    initializeSettings();
    
    // Variável para armazenar o tema atual
    let currentTheme = 'default';
    
    // Função para detectar o tema do Figma
    function detectFigmaTheme() {
      // Verificar se estamos em um ambiente Figma
      if (typeof parent !== 'undefined' && parent) {
        try {
          // Enviar mensagem para o plugin solicitar o tema do Figma
          parent.postMessage({
            pluginMessage: {
              type: 'get-figma-theme'
            }
          }, '*');
        } catch (error) {
          console.error('Erro ao detectar tema do Figma:', error);
          // Usar tema claro como fallback
          applyTheme('light');
        }
      } else {
        // Ambiente de desenvolvimento, usar tema claro como padrão
        applyTheme('light');
      }
    }
    
    // Função para aplicar o tema
    function applyTheme(theme) {
      console.log('Aplicando tema:', theme);
      
      // Remover classes de tema anteriores
      document.body.classList.remove('dark-theme');
      
      // Se o tema for 'default', detectar o tema do Figma
      if (theme === 'default') {
        // Já estamos tentando detectar o tema do Figma na inicialização
        // Não fazemos nada aqui, pois o tema será aplicado quando recebermos a resposta
        return;
      }
      
      // Aplicar o tema selecionado
      if (theme === 'dark') {
        document.body.classList.add('dark-theme');
      }
      
      // Atualizar a variável global
      currentTheme = theme;
    }
    
    // Initialize language functionality
    function initializeLanguageSystem() {
      console.log('Initializing language system');
      const languageSelect = document.getElementById('language-select');
      
      if (!languageSelect) {
        console.error('Language select element not found');
        return;
      }
      
      // Handle language change in the dropdown (just preview, don't apply yet)
      languageSelect.addEventListener('change', function(e) {
        const selectedLanguage = e.target.value;
        console.log(`Language selection changed to: ${selectedLanguage}`);
        // Don't update the UI yet - wait for Save button
      });
      
      // Set default language (Portuguese)
      currentLanguage = 'pt-br';
      languageSelect.value = currentLanguage;
      
      // Try to get language from plugin storage if available
      try {
        // In Figma plugin environment, we would use clientStorage
        // For now, we'll just use the default language
        parent.postMessage({ pluginMessage: { type: 'get-language-preference' } }, '*');
      } catch (error) {
        console.error('Error getting language preference:', error);
      }
      
      // Apply initial language
      updateUILanguage();
      updateTabContent();
      updateDynamicContent();
      console.log('Language system initialized with language:', currentLanguage);
    }
    
    // Function to update all tab content based on current language
    function updateTabContent() {
      try {
        // Update Update Collections tab
        const updateCollectionsHeading = document.getElementById('update-collections-heading');
        if (updateCollectionsHeading) {
          updateCollectionsHeading.textContent = currentLanguage === 'en' ? 'Update Collections' : 'Atualizar Collections';
        }
        
        // Update form labels in Update Collections tab
        const formLabels = document.querySelectorAll('#update-collections .form-label');
        if (formLabels.length >= 2) {
          formLabels[0].textContent = currentLanguage === 'en' ? 'Reference Library:' : 'Biblioteca de referência:';
          formLabels[1].textContent = currentLanguage === 'en' ? 'Local Collection:' : 'Coleção local:';
        }
        
        // Update help text in Update Collections tab
        const formHelp = document.querySelectorAll('#update-collections .form-help');
        if (formHelp.length >= 2) {
          formHelp[0].textContent = currentLanguage === 'en' ? 
            'Select the external library with the variables you want to use as reference' : 
            'Selecione a biblioteca externa com as variáveis que deseja usar como referência';
          formHelp[1].textContent = currentLanguage === 'en' ? 
            'Select the local collection whose variables will be replaced' : 
            'Selecione a coleção local cujas variáveis serão substituídas';
        }
        
        // Update preview title
        const previewTitle = document.querySelector('.preview-title');
        if (previewTitle) {
          previewTitle.textContent = currentLanguage === 'en' ? 'Preview:' : 'Pré-visualização:';
        }
        
        // Update preview content if it contains the default text
        const previewContent = document.getElementById('preview-content');
        if (previewContent && (previewContent.textContent.includes('Ainda não há nada') || previewContent.textContent.includes('Nothing to preview'))) {
          previewContent.textContent = currentLanguage === 'en' ? 
            'Nothing to preview yet. Select an external library and a local collection to see the matches.' : 
            'Ainda não há nada para pré-visualizar. Selecione uma biblioteca externa e uma coleção local para ver as correspondências.';
        }
        
        // Update button text
        const updateButton = document.getElementById('update-button');
        if (updateButton) {
          updateButton.textContent = currentLanguage === 'en' ? 'Update Collections' : 'Atualizar Collections';
        }
        
        // Update Variables tab
        const updateVariablesHeading = document.querySelector('#update-variables h2');
        if (updateVariablesHeading) {
          updateVariablesHeading.textContent = currentLanguage === 'en' ? 'Update Variables' : 'Substituir Variáveis por Nó';
        }
        
        // Update form labels in Update Variables tab
        const varFormLabels = document.querySelectorAll('#update-variables .form-label');
        if (varFormLabels.length >= 2) {
          varFormLabels[0].textContent = currentLanguage === 'en' ? 'Reference Library:' : 'Biblioteca de referência:';
          varFormLabels[1].textContent = currentLanguage === 'en' ? 'Reference Collection:' : 'Coleção de referência:';
        }
        
        // Update all help text elements
        const helpTextElements = document.querySelectorAll('.form-help');
        helpTextElements.forEach(helpText => {
          if (helpText.textContent.includes('Selecione a coleção de variáveis') || 
              helpText.textContent.includes('Select the variable collection')) {
            helpText.textContent = currentLanguage === 'en' ? 
              'Select the variable collection you want to use as reference' : 
              'Selecione a coleção de variáveis que deseja utilizar como referência';
          } else if (helpText.textContent.includes('Selecione a biblioteca externa') || 
                     helpText.textContent.includes('Select the external library')) {
            helpText.textContent = currentLanguage === 'en' ? 
              'Select the external library with the variables you want to use as reference' : 
              'Selecione a biblioteca externa com as variáveis que deseja usar como referência';
          } else if (helpText.textContent.includes('Selecione a coleção local') || 
                     helpText.textContent.includes('Select the local collection')) {
            helpText.textContent = currentLanguage === 'en' ? 
              'Select the local collection whose variables will be replaced' : 
              'Selecione a coleção local cujas variáveis serão substituídas';
          }
        });
        
        // Update help text in Update Variables tab
        const varFormHelp = document.querySelectorAll('#update-variables .form-help');
        if (varFormHelp.length >= 1) {
          varFormHelp[0].textContent = currentLanguage === 'en' ? 
            'Select the external library with the variables you want to use as reference' : 
            'Selecione a biblioteca externa com as variáveis que deseja usar como referência';
        }
        
        // Update scope label
        const scopeLabel = document.querySelector('.scope-label');
        if (scopeLabel) {
          scopeLabel.textContent = currentLanguage === 'en' ? 'Substitution Scope' : 'Escopo de substituição';
        }
        
        // Update scope options
        const scopeLabels = document.querySelectorAll('#update-variables .radio-label');
        if (scopeLabels.length >= 2) {
          scopeLabels[0].textContent = currentLanguage === 'en' ? 'Current Selection' : 'Seleção Atual';
          scopeLabels[1].textContent = currentLanguage === 'en' ? 'Current Page' : 'Página Atual';
        }
        
        // Update buttons
        const searchButton = document.getElementById('search-button');
        if (searchButton) {
          searchButton.textContent = currentLanguage === 'en' ? 'Search Variables' : 'Buscar Variáveis';
        }
        
        const replaceButton = document.getElementById('replace-button');
        if (replaceButton) {
          replaceButton.textContent = currentLanguage === 'en' ? 'Replace Variables' : 'Substituir Variáveis';
        }
        
        console.log('Tab content updated successfully');
      } catch (error) {
        console.error('Error updating tab content:', error);
      }
    }
    
    // Function to update dynamic content that might not be covered by other update functions
    function updateDynamicContent() {
      try {
        // Update library type labels in List Libraries tab
        const libraryTypeLabels = document.querySelectorAll('.library-type');
        libraryTypeLabels.forEach(label => {
          if (label.textContent === 'Variáveis' || label.textContent === 'Variables' || label.textContent === 'Componentes' || label.textContent === 'Components') {
            if (label.textContent === 'Variáveis' || label.textContent === 'Variables') {
              label.textContent = currentLanguage === 'en' ? 'Variables' : 'Variáveis';
            } else if (label.textContent === 'Componentes' || label.textContent === 'Components') {
              label.textContent = currentLanguage === 'en' ? 'Components' : 'Componentes';
            }
          }
        });
        
        // Update library description labels
        const libraryDescLabels = document.querySelectorAll('.component-id');
        libraryDescLabels.forEach(label => {
          if (label.textContent === 'Biblioteca de Variáveis' || label.textContent === 'Variable Library' || 
              label.textContent === 'Biblioteca de Componentes' || label.textContent === 'Component Library') {
            if (label.textContent === 'Biblioteca de Variáveis' || label.textContent === 'Variable Library') {
              label.textContent = currentLanguage === 'en' ? 'Variable Library' : 'Biblioteca de Variáveis';
            } else if (label.textContent === 'Biblioteca de Componentes' || label.textContent === 'Component Library') {
              label.textContent = currentLanguage === 'en' ? 'Component Library' : 'Biblioteca de Componentes';
            }
          }
        });
        
        // Update the List Libraries tab title
        const listLibrariesTitle = document.querySelector('#list-libs h2');
        if (listLibrariesTitle) {
          listLibrariesTitle.textContent = currentLanguage === 'en' ? 'List Libraries' : 'Lista de Bibliotecas';
        }
        
        // Update all library-related text in the list libraries tab
        const allLibrariesText = document.querySelector('#list-libs .section-title');
        if (allLibrariesText && (allLibrariesText.textContent === 'All libraries:' || allLibrariesText.textContent === 'Todas as bibliotecas:')) {
          allLibrariesText.textContent = currentLanguage === 'en' ? 'All libraries:' : 'Todas as bibliotecas:';
        }
        
        // Update loading options
        const loadingLibrariesOption = document.getElementById('loading-libraries-option');
        if (loadingLibrariesOption) {
          loadingLibrariesOption.textContent = currentLanguage === 'en' ? 
            'Loading libraries...' : 'Carregando bibliotecas...';
        }
        
        const loadingCollectionsOption = document.getElementById('loading-collections-option');
        if (loadingCollectionsOption) {
          loadingCollectionsOption.textContent = currentLanguage === 'en' ? 
            'Loading local collections...' : 'Carregando coleções locais...';
        }
        
        // Update dropdown options
        const selectElements = document.querySelectorAll('select');
        selectElements.forEach(select => {
          Array.from(select.options).forEach(option => {
            // Library selection placeholder
            if (option.text === 'Selecione uma biblioteca...' || option.text === 'Select Library...') {
              option.text = currentLanguage === 'en' ? 'Select Library...' : 'Selecione uma biblioteca...';
            }
            // Collection selection placeholder
            else if (option.text === 'Selecione uma biblioteca primeiro' || option.text === 'Please select a library first') {
              option.text = currentLanguage === 'en' ? 'Please select a library first' : 'Selecione uma biblioteca primeiro';
            }
            // No collections available
            else if (option.text === 'Nenhuma coleção disponível nesta biblioteca' || 
                     option.text === 'No collections available in this library') {
              option.text = currentLanguage === 'en' ? 
                'No collections available in this library' : 
                'Nenhuma coleção disponível nesta biblioteca';
            }
            // Loading collections
            else if (option.text === 'Carregando coleções...' || option.text === 'Loading collections...') {
              option.text = currentLanguage === 'en' ? 'Loading collections...' : 'Carregando coleções...';
            }
            // Loading libraries
            else if (option.text === 'Carregando bibliotecas...' || option.text === 'Loading libraries...') {
              option.text = currentLanguage === 'en' ? 'Loading libraries...' : 'Carregando bibliotecas...';
            }
          });
        });
        
        // Update help text in Variables tab
        const collectionHelpText = document.getElementById('collection-help-text');
        if (collectionHelpText) {
          collectionHelpText.textContent = currentLanguage === 'en' ? 
            'Select the variable collection you want to use as reference' : 
            'Selecione a coleção de variáveis que deseja utilizar como referência';
        }
        
        // Update variables found title
        const variablesFoundTitle = document.getElementById('variables-found-title');
        if (variablesFoundTitle) {
          variablesFoundTitle.textContent = currentLanguage === 'en' ? 
            'Variables and styles found' : 
            'Variáveis e estilos encontrados';
        }
        
        // Update modal note
        const modalNote = document.querySelector('.modal-note');
        if (modalNote) {
          modalNote.textContent = currentLanguage === 'en' ? 
            'Note: The replacement will only be applied to the selected scope.' : 
            'Nota: A substituição será aplicada apenas ao escopo selecionado.';
        }
        
        // Update radio labels
        const radioLabels = document.querySelectorAll('.radio-group label');
        if (radioLabels.length >= 2) {
          if (radioLabels[0].textContent === 'Seleção atual' || radioLabels[0].textContent === 'Current Selection') {
            radioLabels[0].textContent = currentLanguage === 'en' ? 'Current Selection' : 'Seleção atual';
          }
          if (radioLabels[1].textContent === 'Página atual' || radioLabels[1].textContent === 'Current Page') {
            radioLabels[1].textContent = currentLanguage === 'en' ? 'Current Page' : 'Página atual';
          }
        }
        
        // Update all substitution scope labels
        const scopeLabels = document.querySelectorAll('.form-label');
        scopeLabels.forEach(label => {
          if (label.textContent === 'Escopo de substituição' || label.textContent === 'Substitution Scope') {
            label.textContent = currentLanguage === 'en' ? 'Substitution Scope' : 'Escopo de substituição';
          }
        });
        
        // Update all buttons
        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
          if (button.textContent === 'Substituir Variáveis' || button.textContent === 'Replace Variables') {
            button.textContent = currentLanguage === 'en' ? 'Replace Variables' : 'Substituir Variáveis';
          }
        });
        
        // Specifically target the replace button
        const replaceButton = document.querySelector('#replace-button');
        if (replaceButton) {
          replaceButton.textContent = currentLanguage === 'en' ? 'Replace Variables' : 'Substituir Variáveis';
        }
        
        // Update match/unmatch indicators
        const matchIndicators = document.querySelectorAll('.match-indicator');
        matchIndicators.forEach(indicator => {
          if (indicator.textContent === 'match' || indicator.textContent === 'correspondência') {
            indicator.textContent = currentLanguage === 'en' ? 'match' : 'correspondência';
          } else if (indicator.textContent === 'unmatch' || indicator.textContent === 'sem correspondência') {
            indicator.textContent = currentLanguage === 'en' ? 'unmatch' : 'sem correspondência';
          }
        });
        
        // Update preview content if it contains default text
        const previewContent = document.getElementById('preview-content');
        if (previewContent) {
          const contentText = previewContent.textContent.trim();
          if (contentText.includes('Ainda não há nada') || contentText.includes('Nothing to preview')) {
            previewContent.textContent = currentLanguage === 'en' ? 
              'Nothing to preview yet. Select an external library and a local collection to see the matches.' : 
              'Ainda não há nada para pré-visualizar. Selecione uma biblioteca externa e uma coleção local para ver as correspondências.';
          }
        }
        
        console.log('Dynamic content updated successfully');
      } catch (error) {
        console.error('Error updating dynamic content:', error);
      }
    }
    
    // Call initialization on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', function() {
      initializeLanguageSystem();
      // Process i18n elements after DOM is loaded
      processI18nElements();
    });
    
    // Also initialize immediately in case DOM is already loaded
    initializeLanguageSystem();
  </script>
  
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div id="loading-text" class="loading-text">Processando...</div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="footer-version">v0.6.0-beta | PT</div>
    <div class="footer-settings">
      <button id="settings-button" class="settings-button" aria-label="Settings" onclick="return toggleSettings();">
        <span class="material-icons">settings</span>
        <span>Settings</span>
      </button>
    </div>
  </div>

  <!-- Settings Overlay -->
  <div id="settings-overlay" class="settings-overlay">
    <div class="settings-container">
      <div class="settings-header">
        <h3 class="settings-title">Configurações</h3>
        <button id="settings-close" class="settings-close">×</button>
      </div>
      <div class="settings-content">
        <div class="settings-section">
          <label for="language-select">Language / Idioma</label>
          <select id="language-select" class="settings-select">
            <option value="en">English</option>
            <option value="pt-br" selected>Português (Brasil)</option>
          </select>
        </div>
        <div class="settings-section">
          <label for="theme-select">Theme / Tema</label>
          <select id="theme-select" class="settings-select">
            <option value="default" selected>Default (Figma)</option>
            <option value="light">Light / Claro</option>
            <option value="dark">Dark / Escuro</option>
          </select>
        </div>
        <div class="settings-actions">
          <button id="settings-cancel" class="settings-button-secondary">Cancelar</button>
          <button id="settings-update" class="settings-button-primary">Atualizar</button>
        </div>
      </div>
    </div>
  </div>
  </div>
</body>
  <!-- Include translations directly in the HTML file for Figma plugin -->
  <script>
    // Translations embedded directly in the HTML file
    // This ensures they're available in the Figma plugin environment
    const translations = {
      'en': {
        // General
        'language_code': 'EN',
        'language_name': 'English',
        
        // Tabs
        'update_collections': 'Update Collections',
        'update_variables': 'Update Variables',
        'list_libraries': 'List Libraries',
        
        // Update Collections tab
        'update_collections_title': 'Update Collections',
        'reference_library': 'Reference Library:',
        'local_collection': 'Local Collection:',
        'select_library': 'Select Library',
        'select_collection': 'Select Collection',
        'select_local_collection': 'Select Local Collection',
        'update_button': 'Update Collections',
        'no_libraries': 'No libraries available',
        'select_library_first': 'Please select a library first',
        'no_collections': 'No collections available in this library',
        'preview_title': 'Preview:',
        'preview_matches': 'Preview Matches',
        'no_matches_found': 'No matches found',
        'matches_found': 'Matches found:',
        'local_variable': 'Local Variable',
        'library_variable': 'Library Variable',
        'loading_libraries': 'Loading libraries...',
        'loading_local_collections': 'Loading local collections...',
        'no_preview_yet': 'Nothing to preview yet. Select an external library and a local collection to see the matches.',
        'select_external_library_help': 'Select the external library with the variables you want to use as reference',
        'select_local_collection_help': 'Select the local collection whose variables will be replaced',
        'no_local_collections': 'No local collection found. Create local variable collections first.',
        
        // Variable types and properties
        'color_variables': 'Color Variables',
        'fills': 'Fills',
        'strokes': 'Strokes',
        'numeric_variables': 'Numeric Variables',
        'modes': 'Modes',
        'text_variables': 'Text Variables',
        'effects': 'Effects',
        'text_styles': 'Text Styles',
        'layout_grids': 'Layout Grids',
        'others': 'Others',
        'match': 'match',
        'no_match': 'no match',
        'items_with_matches': '<strong>{count} of {total}</strong> items have matches in the selected collection.',
        
        // Update Variables tab
        'update_variables_title': 'Update Variables',
        'reference_library_var': 'Reference Library:',
        'reference_collection': 'Reference Collection:',
        'scope_selection': 'Substitution Scope',
        'current_selection': 'Current Selection',
        'current_page': 'Current Page',
        'search_variables': 'Search Variables',
        'replace_variables': 'Replace Variables',
        'select_library_collection': 'Select Library and Collection',
        'select_scope': 'Select Scope',
        'no_variables_found_selection': 'No variables or styles found in the selected elements.',
        
        // List Libraries tab
        'list_libraries_title': 'List Libraries',
        'all_libraries': 'All libraries:',
        'searching_libraries': 'Searching libraries...',
        'reload': 'Reload',
        'library_id': 'Library ID',
        'library_type': 'Type',
        'component_library': 'Component Library',
        'variable_library': 'Variable Library',
        
        // Settings
        'settings': 'Settings',
        'settings_title': 'Settings',
        'language': 'Language / Idioma',
        'cancel': 'Cancel',
        'save': 'Save',
        'settings_saved': 'Settings saved successfully',
        
        // Messages
        'processing': 'Processing...',
        'processing_substitution': 'Processing variable substitution...',
        'no_selection': 'No elements selected',
        'select_elements': 'Please select elements to process',
        'no_variables_found': 'No variables found',
        'variables_found': 'Variables found:',
        'success': 'Success',
        'error': 'Error',
        'loading': 'Loading...',
        'updating': 'Updating...',
        'searching': 'Searching...',
        
        // Confirmation dialog
        'confirm': 'Confirm',
        'confirm_replace': 'Are you sure you want to replace these variables?',
        'confirm_replacement': 'Confirm Variable Replacement',
        'variables_to_be_replaced': 'Variables to be replaced ({count})',
        'variables_without_matches': 'Variables without matches ({count})',
        'will_be_replaced': 'Will be replaced',
        'no_match_found': 'No match found',
        'replacement_note': 'Note: The replacement will only be applied to the selected scope.',
        'cancel': 'Cancel',
        'confirm_button': 'Confirm Replacement',
        'yes': 'Yes',
        'no': 'No',
        
        // Error messages
        'error_no_library': 'Error: No library selected',
        'error_no_collection': 'Error: No collection selected',
        'error_no_variables': 'Error: No variables found to replace',
        'error_api': 'API Error: Could not complete the operation',
        
        // Success messages
        'success_updated': 'Successfully updated {count} variables',
        'success_replaced': 'Successfully replaced {count} variables',
        'success_updated_with_errors': 'Successfully updated {count} variables. {errors} variables with errors.',
        'failed_update_variables': 'Failed to update variables. {errors} variables with errors.',
        'error_generic': 'An error occurred',
        'no_matches_found': 'No matches found',
        'found_matches': 'Found {count} matches',
        'starting_variable_replacement': 'Starting variable replacement...',
        'select_collection_preview': 'Select a collection to preview variables.',
        
        // Footer
        'version': 'v{version}',
        'version_with_lang': 'v{version} | {lang}'
      },
      'pt-br': {
        // General
        'language_code': 'PT-BR',
        'language_name': 'Português',
        
        // Tabs
        'update_collections': 'Atualizar Coleções',
        'update_variables': 'Atualizar Variáveis',
        'list_libraries': 'Listar Bibliotecas',
        
        // Update Collections tab
        'update_collections_title': 'Atualizar Coleções',
        'reference_library': 'Biblioteca de referência:',
        'local_collection': 'Coleção local:',
        'select_library': 'Selecionar Biblioteca',
        'select_collection': 'Selecionar Coleção',
        'select_local_collection': 'Selecionar Coleção Local',
        'update_button': 'Atualizar Coleções',
        'no_libraries': 'Nenhuma biblioteca disponível',
        'select_library_first': 'Por favor, selecione uma biblioteca primeiro',
        'no_collections': 'Nenhuma coleção disponível nesta biblioteca',
        'preview_title': 'Pré-visualização:',
        'preview_matches': 'Visualizar Correspondências',
        'no_matches_found': 'Nenhuma correspondência encontrada',
        'matches_found': 'Correspondências encontradas:',
        'local_variable': 'Variável Local',
        'library_variable': 'Variável da Biblioteca',
        'loading_libraries': 'Carregando bibliotecas...',
        'loading_local_collections': 'Carregando coleções locais...',
        'no_preview_yet': 'Ainda não há nada para pré-visualizar. Selecione uma biblioteca externa e uma coleção local para ver as correspondências.',
        'select_external_library_help': 'Selecione a biblioteca externa com as variáveis que deseja usar como referência',
        'select_local_collection_help': 'Selecione a coleção local cujas variáveis serão substituídas',
        'no_local_collections': 'Nenhuma coleção local encontrada. Crie coleções de variáveis locais primeiro.',
        
        // Variable types and properties
        'color_variables': 'Variáveis de Cor',
        'fills': 'Preenchimentos',
        'strokes': 'Bordas',
        'numeric_variables': 'Variáveis Numéricas',
        'modes': 'Modos',
        'text_variables': 'Variáveis de Texto',
        'effects': 'Efeitos',
        'text_styles': 'Estilos de Texto',
        'layout_grids': 'Grids de Layout',
        'others': 'Outros',
        'match': 'correspondência',
        'no_match': 'sem correspondência',
        'items_with_matches': '<strong>{count} de {total}</strong> itens têm correspondência na coleção selecionada.',
        
        // Update Variables tab
        'update_variables_title': 'Atualizar Variáveis',
        'reference_library_var': 'Biblioteca de referência:',
        'reference_collection': 'Coleção de referência:',
        'scope_selection': 'Escopo de substituição',
        'current_selection': 'Seleção Atual',
        'current_page': 'Página Atual',
        'search_variables': 'Buscar Variáveis',
        'replace_variables': 'Substituir Variáveis',
        'select_library_collection': 'Selecionar Biblioteca e Coleção',
        'select_scope': 'Selecionar Escopo',
        'no_variables_found_selection': 'Nenhuma variável ou estilo encontrado nos elementos selecionados.',
        
        // List Libraries tab
        'list_libraries_title': 'Lista de Bibliotecas',
        'all_libraries': 'Todas as bibliotecas:',
        'searching_libraries': 'Procurando bibliotecas...',
        'reload': 'Recarregar',
        'library_id': 'ID da Biblioteca',
        'library_type': 'Tipo',
        'component_library': 'Biblioteca de Componentes',
        'variable_library': 'Biblioteca de Variáveis',
        
        // Settings
        'settings': 'Configurações',
        'settings_title': 'Configurações',
        'language': 'Idioma / Language',
        'cancel': 'Cancelar',
        'save': 'Salvar',
        'settings_saved': 'Configurações salvas com sucesso',
        
        // Messages
        'processing': 'Processando...',
        'processing_substitution': 'Processando substituição de variáveis...',
        'no_selection': 'Nenhum elemento selecionado',
        'select_elements': 'Por favor, selecione elementos para processar',
        'no_variables_found': 'Nenhuma variável encontrada',
        'variables_found': 'Variáveis encontradas:',
        'success': 'Sucesso',
        'error': 'Erro',
        'loading': 'Carregando...',
        'updating': 'Atualizando...',
        'searching': 'Pesquisando...',
        
        // Confirmation dialog
        'confirm': 'Confirmar',
        'confirm_replace': 'Tem certeza que deseja substituir essas variáveis?',
        'confirm_replacement': 'Confirmar Substituição de Variáveis',
        'variables_to_be_replaced': 'Variáveis a serem substituídas ({count})',
        'variables_without_matches': 'Variáveis sem correspondência ({count})',
        'will_be_replaced': 'Será substituída',
        'no_match_found': 'Sem correspondência',
        'replacement_note': 'Nota: A substituição será aplicada apenas ao escopo selecionado.',
        'cancel': 'Cancelar',
        'confirm_button': 'Confirmar Substituição',
        'yes': 'Sim',
        'no': 'Não',
        
        // Error messages
        'error_no_library': 'Erro: Nenhuma biblioteca selecionada',
        'error_no_collection': 'Erro: Nenhuma coleção selecionada',
        'error_no_variables': 'Erro: Nenhuma variável encontrada para substituir',
        'error_api': 'Erro de API: Não foi possível completar a operação',
        
        // Success messages
        'success_updated': 'Atualizadas com sucesso {count} variáveis',
        'success_replaced': 'Substituídas com sucesso {count} variáveis',
        'success_updated_with_errors': '{count} variáveis atualizadas com sucesso. {errors} variáveis com erro.',
        'failed_update_variables': 'Não foi possível atualizar as variáveis. {errors} variáveis com erro.',
        'error_generic': 'Ocorreu um erro',
        'found_matches': 'Encontradas {count} correspondências',
        'starting_variable_replacement': 'Iniciando substituição de variáveis...',
        'select_collection_preview': 'Selecione uma coleção para visualizar variáveis.',
        
        // Footer
        'version': 'v{version}',
        'version_with_lang': 'v{version} | {lang}'
      }
    };
    
    // Make translations available globally
    window.translations = translations;
  </script>
</html> 
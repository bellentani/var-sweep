<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 20px;
      color: #333;
    }
    
    h2 {
      font-size: 16px;
      margin-bottom: 12px;
    }
    
    .component-item {
      padding: 12px;
      border-radius: 6px;
      background-color: #f5f5f5;
      margin-bottom: 8px;
    }
    
    .library-label {
      display: inline-block;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 3px;
      margin-right: 6px;
      background-color: #e0f2fe;
      color: #0284c7;
    }
    
    .component-name {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .component-id {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }
    
    .library-name {
      font-size: 12px;
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      background-color: #e6f7ff;
      color: #0070e0;
      margin-top: 4px;
    }
    
    .no-components {
      color: #888;
      font-style: italic;
    }
    
    .error-message {
      background-color: #fee2e2;
      color: #b91c1c;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
    }
    
    .info-message {
      background-color: #f0f9ff;
      color: #075985;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
    }
    
    .action-button {
      background-color: #0070e0;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      margin-top: 16px;
      display: block;
      width: 100%;
    }
    
    .action-button:hover {
      background-color: #0057b3;
    }
  </style>
</head>
<body>
  <h2>Componentes de Bibliotecas</h2>
  <div id="error-container" style="display: none;" class="error-message"></div>
  <div id="info-container" style="display: none;" class="info-message"></div>
  <div id="components-container">
    <p class="no-components">Procurando componentes de bibliotecas...</p>
  </div>
  
  <button id="refresh-button" class="action-button">Recarregar</button>

  <script>
    // Elementos do DOM
    const componentsContainer = document.getElementById('components-container');
    const errorContainer = document.getElementById('error-container');
    const infoContainer = document.getElementById('info-container');
    const refreshButton = document.getElementById('refresh-button');
    
    // Função para mostrar erro
    function showError(message) {
      errorContainer.textContent = message || "Ocorreu um erro desconhecido";
      errorContainer.style.display = "block";
    }
    
    // Função para esconder erro
    function hideError() {
      errorContainer.style.display = "none";
    }
    
    // Função para mostrar informação
    function showInfo(message) {
      infoContainer.textContent = message || "";
      infoContainer.style.display = message ? "block" : "none";
    }
    
    // Evento para o botão de recarregar
    refreshButton.addEventListener('click', () => {
      componentsContainer.innerHTML = '<p class="no-components">Procurando componentes de bibliotecas...</p>';
      hideError();
      showInfo("");
      parent.postMessage({ pluginMessage: { type: 'recarregar' } }, '*');
    });
    
    // Escuta as mensagens enviadas pelo código do plugin
    window.onmessage = async (event) => {
      try {
        const message = event.data.pluginMessage;
        
        if (!message) {
          showError("Mensagem inválida recebida do plugin");
          return;
        }
        
        // Tratamento de erros
        if (message.type === 'error') {
          showError(message.message);
          return;
        }
        
        if (message.type === 'libraries-data') {
          const libraries = message.libraries || [];
          showInfo(message.message || "");
          
          componentsContainer.innerHTML = '';
          hideError();
          
          if (!libraries || libraries.length === 0) {
            componentsContainer.innerHTML = '<p class="no-components">Não foram encontrados componentes de bibliotecas neste arquivo</p>';
            return;
          }
          
          libraries.forEach((component) => {
            if (!component) return; // Pula componentes inválidos
            
            const componentElement = document.createElement('div');
            componentElement.className = 'component-item';
            
            // Adicionar etiqueta de componente
            const labelElement = document.createElement('span');
            labelElement.className = 'library-label';
            labelElement.textContent = 'Componente de Biblioteca';
            componentElement.appendChild(labelElement);
            
            // Nome do componente
            const nameElement = document.createElement('div');
            nameElement.className = 'component-name';
            nameElement.textContent = component.name || 'Componente sem nome';
            componentElement.appendChild(nameElement);
            
            // ID do componente
            const idElement = document.createElement('div');
            idElement.className = 'component-id';
            idElement.textContent = `ID: ${component.id || 'Desconhecido'}`;
            componentElement.appendChild(idElement);
            
            // Nome da biblioteca (se disponível)
            if (component.library) {
              const libraryElement = document.createElement('div');
              libraryElement.className = 'library-name';
              libraryElement.textContent = component.library;
              componentElement.appendChild(libraryElement);
            }
            
            componentsContainer.appendChild(componentElement);
          });
        }
      } catch (error) {
        console.error("Erro ao processar mensagem:", error);
        showError("Erro ao processar dados: " + (error.message || "erro desconhecido"));
      }
    };
    
    // Informa ao plugin que a UI está pronta
    parent.postMessage({ pluginMessage: { type: 'ui-ready' } }, '*');
  </script>
</body>
</html> 
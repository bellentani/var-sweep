<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      color: #333;
    }
    
    .container {
      padding: 20px;
    }
    
    h2 {
      font-size: 16px;
      margin-bottom: 12px;
    }
    
    .component-item {
      padding: 12px;
      border-radius: 6px;
      background-color: #f5f5f5;
      margin-bottom: 8px;
    }
    
    .library-label {
      display: inline-block;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 3px;
      margin-right: 6px;
      background-color: #e0f2fe;
      color: #0284c7;
    }
    
    .component-name {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .component-id {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }
    
    .library-name {
      font-size: 12px;
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      background-color: #e6f7ff;
      color: #0070e0;
      margin-top: 4px;
    }
    
    .no-components {
      color: #888;
      font-style: italic;
    }
    
    .error-message {
      background-color: #fee2e2;
      color: #b91c1c;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
    }
    
    .info-message {
      background-color: #f0f9ff;
      color: #075985;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
    }
    
    .action-button {
      background-color: #0070e0;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      margin-top: 16px;
      display: block;
      width: 100%;
    }
    
    .action-button:hover {
      background-color: #0057b3;
    }

    .library-select {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .collections-container {
      margin-top: 16px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 12px;
      max-height: 200px;
      overflow-y: auto;
    }

    .collection-item {
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 6px;
      background-color: #f9fafb;
    }

    .collection-name {
      font-weight: 500;
      font-size: 13px;
    }

    .collection-type {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-top: 20px;
      margin-bottom: 10px;
      color: #374151;
    }

    .loading {
      text-align: center;
      color: #6b7280;
      font-style: italic;
      padding: 12px;
    }

    .hidden {
      display: none;
    }
    
    /* Estilos para as abas */
    .tabs {
      display: flex;
      border-bottom: 1px solid #e5e7eb;
      background-color: #f3f4f6;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .tab {
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.3s ease;
      text-align: center;
      flex: 1;
    }
    
    .tab.active {
      border-bottom-color: #0070e0;
      color: #0070e0;
      background-color: #fff;
    }
    
    .tab-content {
      padding: 16px;
    }
    
    .tab-pane {
      display: none;
    }
    
    .tab-pane.active {
      display: block;
    }
    
    /* Estilos para a aba Update Variables */
    .variable-form {
      margin-top: 16px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
      color: #374151;
    }
    
    .form-input, .form-select {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
      margin-bottom: 8px;
    }
    
    .form-select {
      background-color: white;
    }
    
    .form-help {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }
    
    .variable-preview {
      background-color: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 12px;
      margin-top: 16px;
    }
    
    .preview-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #374151;
    }
    
    .preview-content {
      font-size: 12px;
      color: #4b5563;
      font-family: 'Roboto Mono', monospace;
      white-space: pre-wrap;
    }

    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }
    
    .radio-label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    
    input[type="radio"] {
      margin: 0;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Tab Navigation -->
  <div class="tabs">
    <div class="tab active" data-tab="update-collections">Update Collections</div>
    <div class="tab" data-tab="update-variables">Update Variables</div>
    <div class="tab" data-tab="list-libs">List Libraries</div>
  </div>

  <!-- Tab Contents -->
  <div class="tab-content">
    <!-- Conteúdo da Aba Update Collections -->
    <div class="tab-pane active" id="update-collections">
      <h2>Update Collections</h2>
      <p>Substitua variáveis locais por equivalentes de uma biblioteca.</p>
      <div class="form-group">
        <label for="lib-select">Selecione uma biblioteca:</label>
        <select id="lib-select" class="select-field">
          <option value="">Selecione...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="collection-select">Selecione uma coleção:</label>
        <select id="collection-select" class="select-field">
          <option value="">Selecione...</option>
        </select>
      </div>
      <div class="form-group">
        <button id="update-collection-btn" class="primary-button">Substituir Variáveis</button>
      </div>
      <div id="update-status"></div>
    </div>
    
    <!-- Conteúdo da Aba Update Variables -->
    <div class="tab-pane" id="update-variables">
      <h2>Update Variables</h2>
      <p>Atualize as variáveis aplicadas aos nós/elementos.</p>
      <div class="form-group">
        <p>Funcionalidade em desenvolvimento.</p>
        <p>Esta aba permitirá atualizar variáveis em nós (elementos) ao invés de coleções.</p>
      </div>
    </div>

    <!-- Conteúdo da Aba List Libs -->
    <div class="tab-pane" id="list-libs">
      <h2>Biblioteca Sweep</h2>
      <div id="error-container" style="display: none;" class="error-message"></div>
      <div id="info-container" style="display: none;" class="info-message"></div>
      
      <ul id="library-list" class="library-list">
        <li class="loading">Carregando bibliotecas...</li>
      </ul>
      
      <button id="refresh-button" class="action-button">Recarregar</button>
    </div>
  </div>

  <script>
    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
      // Informa ao plugin que a UI está pronta
      parent.postMessage({ pluginMessage: { type: 'ui-ready' } }, '*');
      
      // Configurar a navegação entre abas
      setupTabs();
      
      // Configurar os listeners para os botões e selects
      setupEventListeners();
    });

    // Configuração da navegação entre abas
    function setupTabs() {
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          // Remover a classe 'active' de todas as abas
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
          
          // Adicionar a classe 'active' à aba clicada
          tab.classList.add('active');
          
          // Mostrar o conteúdo correspondente
          const tabId = tab.getAttribute('data-tab');
          if (tabId) {
            const tabPane = document.getElementById(tabId);
            if (tabPane) {
              tabPane.classList.add('active');
            }
          }
        });
      });
    }

    // Configurar listeners para botões e selects
    function setupEventListeners() {
      // Elementos da aba Update Collections
      const libSelect = document.getElementById('lib-select');
      const collectionSelect = document.getElementById('collection-select');
      const updateCollectionBtn = document.getElementById('update-collection-btn');
      const updateStatus = document.getElementById('update-status');
      
      // Elementos da aba List Libraries
      const libraryList = document.getElementById('library-list');
      const refreshButton = document.getElementById('refresh-button');
      const errorContainer = document.getElementById('error-container');
      const infoContainer = document.getElementById('info-container');
      
      // Manipulador do select de biblioteca na aba Update Collections
      if (libSelect) {
        libSelect.addEventListener('change', () => {
          const libraryId = libSelect.value;
          if (!libraryId) {
            collectionSelect.innerHTML = '<option value="">Selecione uma biblioteca primeiro</option>';
            return;
          }
          
          collectionSelect.innerHTML = '<option value="">Carregando coleções...</option>';
          
          parent.postMessage({ 
            pluginMessage: { 
              type: 'get-collections', 
              libraryId 
            } 
          }, '*');
        });
      }
      
      // Manipulador do botão de atualizar coleções
      if (updateCollectionBtn) {
        updateCollectionBtn.addEventListener('click', () => {
          const libraryId = libSelect.value;
          const collectionId = collectionSelect.value;
          
          if (!libraryId || !collectionId) {
            updateStatus.textContent = 'Selecione uma biblioteca e uma coleção primeiro.';
            return;
          }
          
          updateStatus.textContent = 'Processando substituição de variáveis...';
          
          parent.postMessage({ 
            pluginMessage: { 
              type: 'update-collections', 
              libraryId,
              collectionId
            } 
          }, '*');
        });
      }
      
      // Manipulador do botão de recarregar na aba List Libraries
      if (refreshButton) {
        refreshButton.addEventListener('click', () => {
          errorContainer.style.display = 'none';
          infoContainer.style.display = 'none';
          libraryList.innerHTML = '<li class="loading">Carregando bibliotecas...</li>';
          
          parent.postMessage({ 
            pluginMessage: { 
              type: 'get-libraries' 
            } 
          }, '*');
        });
      }
      
      // Carregar bibliotecas inicialmente
      parent.postMessage({ 
        pluginMessage: { 
          type: 'get-libraries' 
        } 
      }, '*');
    }

    // Manipular mensagens recebidas do código do plugin
    window.onmessage = (event) => {
      const message = event.data.pluginMessage;
      
      if (!message) return;
      
      // Elementos que vamos precisar
      const libSelect = document.getElementById('lib-select');
      const collectionSelect = document.getElementById('collection-select');
      const updateStatus = document.getElementById('update-status');
      const libraryList = document.getElementById('library-list');
      const errorContainer = document.getElementById('error-container');
      const infoContainer = document.getElementById('info-container');
      
      switch (message.type) {
        case 'libraries-loaded':
          // Atualizar o select de bibliotecas na aba Update Collections
          if (libSelect) {
            const options = message.libraries.map((lib) => 
              `<option value="${lib.id}">${lib.name}</option>`
            ).join('');
            
            libSelect.innerHTML = '<option value="">Selecione uma biblioteca</option>' + options;
          }
          
          // Atualizar a lista de bibliotecas na aba List Libraries
          if (libraryList) {
            displayLibraries(message.libraries, libraryList);
          }
          break;
          
        case 'collections-loaded':
          // Atualizar o select de coleções na aba Update Collections
          if (collectionSelect) {
            const options = message.collections.map((collection) =>
              `<option value="${collection.id}">${collection.name}</option>`
            ).join('');
            
            collectionSelect.innerHTML = '<option value="">Selecione uma coleção</option>' + options;
          }
          break;
          
        case 'collections-for-display-loaded':
          // Manipular a exibição de coleções na aba List Libraries
          const collectionsContainer = document.getElementById(`collections-${message.libraryId}`);
          if (collectionsContainer) {
            if (message.collections.length === 0) {
              collectionsContainer.innerHTML = '<p>Nenhuma coleção encontrada nesta biblioteca.</p>';
            } else {
              let collectionsHtml = '<ul class="collections-list">';
              message.collections.forEach((collection) => {
                collectionsHtml += `<li>${collection.name}</li>`;
              });
              collectionsHtml += '</ul>';
              collectionsContainer.innerHTML = collectionsHtml;
            }
          }
          break;
          
        case 'update-collections-result':
          // Exibir resultado da atualização de coleções
          if (updateStatus) {
            updateStatus.textContent = message.success 
              ? `Sucesso! ${message.updatedCount} variáveis foram substituídas.` 
              : `Erro: ${message.error}`;
          }
          break;
          
        case 'error':
          // Exibir mensagens de erro gerais
          console.error('Erro recebido:', message.error);
          
          // Determinar onde exibir o erro com base no contexto
          if (message.context === 'update-collections') {
            if (updateStatus) {
              updateStatus.textContent = `Erro: ${message.error}`;
            }
          } else {
            // Usar o container de erro geral na aba List Libraries
            if (errorContainer) {
              errorContainer.style.display = 'block';
              errorContainer.textContent = message.error;
            }
          }
          break;
      }
    };

    // Função para exibir a lista de bibliotecas
    function displayLibraries(libraries, libraryList) {
      if (!libraryList) return;
      
      if (libraries.length === 0) {
        libraryList.innerHTML = '<li class="empty-list">Nenhuma biblioteca encontrada.</li>';
        return;
      }
      
      let html = '';
      libraries.forEach(library => {
        html += `
          <li class="library-item">
            <div class="library-header">
              <h3>${library.name}</h3>
            </div>
            <button class="view-collections-btn" data-library-id="${library.id}">
              Ver Coleções
            </button>
            <div class="collections-container" id="collections-${library.id}" style="display: none;"></div>
          </li>
        `;
      });
      
      libraryList.innerHTML = html;
      
      // Adicionar handlers para os botões de ver coleções
      document.querySelectorAll('.view-collections-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const btn = e.currentTarget;
          const libraryId = btn.getAttribute('data-library-id');
          
          if (!libraryId) {
            console.error('Atributo data-library-id não encontrado');
            return;
          }
          
          const collectionsContainer = document.getElementById(`collections-${libraryId}`);
          
          if (collectionsContainer) {
            if (collectionsContainer.style.display === 'none') {
              // Se ainda não carregou as coleções, solicitar
              if (collectionsContainer.innerHTML === '') {
                collectionsContainer.innerHTML = '<p>Carregando coleções...</p>';
                
                parent.postMessage({ 
                  pluginMessage: { 
                    type: 'get-collections-for-display', 
                    libraryId 
                  } 
                }, '*');
              }
              
              collectionsContainer.style.display = 'block';
              btn.textContent = 'Esconder Coleções';
            } else {
              collectionsContainer.style.display = 'none';
              btn.textContent = 'Ver Coleções';
            }
          }
        });
      });
    }
  </script>
</body>
</html> 